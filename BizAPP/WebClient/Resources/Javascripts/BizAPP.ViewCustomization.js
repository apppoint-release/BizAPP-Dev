/*!*
* Copyright (C) 2000 - 2011, AppPoint Software Solutions.
* The program code and other information contained herein are not for public use, 
* include confidential and proprietary information owned by AppPoint Software Solutions. 
* Any reproduction, disclosure, reverse engineering, in whole or in part, is prohibited 
* unless with prior explicit written consent of AppPoint Software Solutions. 
*
* This software is protected by local Copyright law, patent law, and international treaties.
* Unauthorized reproduction or distribution may be subject to civil and criminal penalties and is 
* strictly prohibited. Portions of this program code, documentation, processes, and information 
* could be patent pending.
* 
**/
var BizAPP=BizAPP||{UI:{}};BizAPP.ViewCustomization={Container:null,OriginalContainer:null,BlockHeadings:null,HelpUrl:"",PlaceholderText:"",ActionsHTML:null,MenuPopupHTML:null,redips:{},g_viewname:"",ListViewsHTML:'<div class="bza-bcv-menu-cont popup-container tbdd cem_child last bzapp" style="float:right" onclick="BizAPP.ViewCustomization.ListViews(event);"><table cellspacing="0" cellpadding="0"><tbody><tr><td><a class="tblink mslink" style="padding:0 2px;color:black;">Personalize</a></td><td><i class="fa fa-sort-desc" style="font:normal normal normal 16px/1 FontAwesome;position:relative;top:-2px;"></i></td></tr></tbody></table></div>',listViewTemplate:'<div class="list-views" style="line-height:20px;font-weight:normal;"><div class="fldiv edit" id = "edit" onmouseover="BizAPP.ViewCustomization.Highlight(event, true);" onmouseout="BizAPP.ViewCustomization.Highlight(event, false);" onclick="BizAPP.ViewCustomization.Edit(event, true, \'{1}\', \'{2}\');">Create New</div><div class="fldiv edit" id = "edit" onmouseover="BizAPP.ViewCustomization.Highlight(event, true);" onmouseout="BizAPP.ViewCustomization.Highlight(event, false);" onclick="BizAPP.ViewCustomization.LoadPersonalizedView(event, true);" style="padding-bottom:5px;">Switch to Default</div><div class="flsep" style="padding-bottom:5px;"></div><div class="fldiv" style="padding-bottom:5px;">Personalized Views</div><div class="bcv-views-cont" style="padding-left:10px;">{0}</div></div>',subItemTemplate:' <option value="{0}"> {1} </option>',Init:function(a,b){if(a.container.length){BizAPP.ViewCustomization.OriginalContainer=$(a.container);BizAPP.ViewCustomization.Container=$(a.container).closest("[bizapp_context]");BizAPP.ViewCustomization.BlockHeadings=a.headings;BizAPP.ViewCustomization.HelpUrl=a.helpUrl;BizAPP.ViewCustomization.PlaceholderText=a.placeholderText;BizAPP.ViewCustomization.ActionsHTML='<div class="ViewCustomAction" style="display: none">            <div style="display: inline">            <select class="formcombobox viewname" onchange="BizAPP.ViewCustomization.LoadPersonalizedView()" name="ddlPViews" style="width: 205px;display:none;"> {0} </select>             <input class="formtextbox" id="bza-vc-column" placeholder="no. of columns" type="number"  min="1" style="width:5rem"/>            <span class="stepcenternormal cancel fa fa-thumbs-up" id="cancel" onclick="BizAPP.UI.Packery.PackerySetup()" style="display:none;margin-left:2px;" title="Apply"></span>            <input class="formtextbox name" placeholder="Name"  id="tbPViewName" style="width:10rem;margin-left:2px;display:none" />            <label class="showtoall" style="display:none;font-size: 14px;vertical-align: middle;" for="chk-showtoall"> <input type="checkbox" id="chk-showtoall" class="showtoall" name="showtoall" style="display:none;margin-left:2px;margin-right: 6px;"/>Show to All</label>            <label class="bcv-is" style="display:none;font-size: 14px;vertical-align: middle;" for="chk-instancespecific"> <input type="checkbox" id="chk-instancespecific" class="bcv-is" name="instancespecific" style="display:none;margin-left:2px;margin-right: 6px;"/>Instance Specific</label>            <span class="stepcenternormal save fa fa-save" id = "save" onclick="BizAPP.ViewCustomization.Save();" style="display:none;margin-left:15px;" title="Save"></span>            <span class="stepcenternormal cancel fa fa-close" id="cancel" onclick="BizAPP.ViewCustomization.Cancel();" style="display:none;margin-left:2px;" title="Cancel"></span></div>            <span class="stepcenternormal cancel fa fa-refresh" id="cancel" onclick="$(\'.bza-vc-grid\').packery()" style="display:none;margin-left:2px;float:right" title="Relayout"></span><span class="available-ctrl-list popup-container tbdd cem_child last bzapp" style="float:right;display:none;padding: 5px!important;" onclick="BizAPP.ViewCustomization.ShowAvailableControls(event);"><table cellspacing="0" cellpadding="0"><tbody><tr><td><span style="padding:0 2px;color:black;">Available Controls</span></td><td><i class="fa fa-sort-desc" style="font:normal normal normal 16px/1 FontAwesome;position:relative;top:-2px;"></i></td></tr></tbody></table></span></div>';BizAPP.ViewCustomization.OriginalContainer.prepend(BizAPP.ViewCustomization.ListViewsHTML)}},ListViews:function(a){BizAPP.ViewCustomization.LoadDependency(function(){var b=BizAPP.ViewCustomization.Container.attr("bizapp_eid");var c=BizAPP.ViewCustomization.Container.attr("bizapp_context");realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["GetPersonalisedViewNames",b,c],true,function(j,l,h){var f=BizAPP.UI._handleEventsAndExceptions(j,l,h);var e=$.parseJSON(f[1]);var g='<div><table><tr><td style="width:{3};"><div class="fldiv" onclick="BizAPP.ViewCustomization.LoadPersonalizedView(event, false);">{0}</div></td>                    <td onclick="BizAPP.ViewCustomization.SetDefaultView(event);" ><i class="fa {1}" title="Default" style="font:normal normal normal 15px/1 FontAwesome;"></i></td>                    <td onclick="BizAPP.ViewCustomization.Edit(event, false, \'{4}\', \'{5}\', {7}, {8}, {9});" style="display:{2}"><i class="fa fa-edit" title="Edit" style="font:normal normal normal 15px/1 FontAwesome;"></i></td>                    <td  onclick="BizAPP.ViewCustomization.Remove(event);" style="display:{2}"><i class="fa fa-trash-o" bza_is="{6}" title="Remove" style="font:normal normal normal 15px/1 FontAwesome;"></i></td></tr></table></div>';var k="";$.each(e,function(o,n){var p=o.split("[SEP]");var q=p[1]=="true";var m=(g_hasSysAdminResp||g_hasAppAdminResp)||!q;if(n){k+=g.format(p[0],"fa-check-square-o",m?"":"none",m?"70%":"68%",BizAPP.ViewCustomization.HelpUrl,BizAPP.ViewCustomization.PlaceholderText,p[2],p[2]=="true",n,q)}else{k+=g.format(p[0],"fa-square-o",m?"":"none",m?"70%":"68%",BizAPP.ViewCustomization.HelpUrl,BizAPP.ViewCustomization.PlaceholderText,p[2],p[2]=="true",n,q)}});BizAPP.ViewCustomization.MenuPopupHTML=BizAPP.ViewCustomization.listViewTemplate.format(k,BizAPP.ViewCustomization.HelpUrl,BizAPP.ViewCustomization.PlaceholderText);var d=$(a.target).closest("table");BizAPP.MenuPopup.Create({html:BizAPP.ViewCustomization.MenuPopupHTML,selector:d,mode:"open",position:"bottom",callback:function(){a.stopPropagation();d.find(".dropdown-menu.bottom").css("margin","0").show()}})})})},ConstructHTML:function(){var a;$(".ViewControlEx:not(.ViewletControlEx)").each(function(){if($(this).attr("bizapp_name")){a+=BizAPP.ViewCustomization.listViewSubTemplate.format($(this).attr("bizapp_name"))}});return BizAPP.ViewCustomization.listViewTemplate.format(a)},AddActions:function(a){if($(".bza-bcv-menu-cont").length){$(".bza-bcv-menu-cont").remove()}$(".ViewCustomAction").remove();if($(".ViewCustomAction").length==0){BizAPP.ViewCustomization.Container.prepend(BizAPP.ViewCustomization.ActionsHTML);$(".bza-bcv-menu-cont.bzapp").next().css("clear","both")}if($(".ViewCustomAction .viewname").has("option").length<=0){$(".ViewCustomAction .viewname").css("display","none");$(".ViewCustomAction .remove").css("display","none")}if(BizAPP.ViewCustomization.g_viewname){$(".ViewCustomAction .viewname").val(BizAPP.ViewCustomization.g_viewname)}else{$(".ViewCustomAction .viewname").val(a)}},Edit:function(g,d,a,c,b,f,h){BizAPP.ViewCustomization.LoadControlListAndTable(g,d,false,a,c,b,f,h)},InitMenuBar:function(b,a,c){$("#myContainer1 .bza-vc-grid-item.w4").parent().remove();$(".ViewCustomAction .name").val(a);BizAPP.ViewCustomization.ShowOptions(b);BizAPP.ViewCustomization.LoadPersonizableControl();BizAPP.ViewCustomization.LoadWidgetList(c)},Remove:function(h){if(confirm("Are you sure you want to remove this Personalized View?")){var b=$(h.target),j=b.closest("[bizapp_name].ViewControlEx");var a=j.attr("bizapp_eid");var k=j.attr("bizappid");var g=j.attr("bizapp_context").split("\n")[0];var f=b.closest("tr").find(".fldiv").text().trim();var c=j;var d=b.attr("bza_is");realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["RemovePersonalisedViewByName","",f,a,g,d],true,function(m,n,l){var e=BizAPP.UI._handleEventsAndExceptions(m,n,l);BizAPP.ViewCustomization.RefreshView(a,k,c,"",g)})}},Cancel:function(){var d=$(".ViewCustomAction #save").closest(".ViewControlEx");var c=d.attr("bizapp_eid");var a=d.attr("bizappid");var e=$(".ViewCustomAction .name:last").val().trim();var b=d.attr("bizapp_context").split("\n")[0];BizAPP.ViewCustomization.RefreshView(c,a,d,e,b)},Save:function(){var e=$(".ViewCustomAction #save").closest(".ViewControlEx");var d=e.attr("bizapp_eid");var a=e.attr("bizappid");var f=$(".ViewCustomAction .name:last").val().trim();var b=e.attr("bizapp_context").split("\n")[0];if(f){BizAPP.ViewCustomization.g_viewname=f;var h=$("#chk-showtoall:checked").length?"true":"false";var g=$("#chk-instancespecific:checked").length?"true":"false";var c=BizAPP.ViewCustomization.GetLayout();realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["AddPersonalisedView",f,c,d,a,h,g,b],true,function(l,m,k){var j=BizAPP.UI._handleEventsAndExceptions(l,m,k);BizAPP.ViewCustomization.RefreshView(d,a,e,f,b)})}else{alert("Name is mandatory")}},SaveDynamicReportDesign:function(){var c=$("#bza-custom-view").closest("[bizapp_name].ViewControlEx");var a=c.attr("bizapp_context").split("\n")[0];var b=BizAPP.ViewCustomization.GetLayout(true);realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["UpdateDynamicReport",a,b],true,function(e,f,d){ProcessingStatus(false,true);BizAPP.UI.LoadView({url:"uiview.asmx?html.args=runtimeviewenterpriseid[NVS]ESystemb1e33[PMS]runtimeobjectid[NVS]"+BizAPP.ViewCustomization.DynamicReport._drilldownReport+"&html.jar=true&html.vcn="+c.parent().attr("id")+":dummy",selector:$($('[bizapp_name="View_DesignView"]').get(0)).parent()})})},GetLayout:function(a){var b=$("#myContainer1 .bza-vc-grid").clone();b.find(".bcv-icon,.bza-resize-menu-cont, .bza-menu-cont, .bcv-preview-cont").remove();var d=b[0].outerHTML;var c=b.find("[widid],[defeid]");$.each(c,function(){var e=$(this);if(e.is("[defeid]")){var f;if(e.attr("widname")){f=e.attr("widname")}else{f=e.text().trim()}d=d.replace(this.outerHTML,'<div title1="{0}" defeid="{1}" widtype="{2}"><!--{0}--></div>'.format(f,e.attr("defeid"),e.attr("widtype")))}else{d=d.replace(this.outerHTML,'<div title1="{0}" widname="{0}" widid="{1}" widtype="{2}"><!--{1}--></div>'.format(e.attr("widname"),e.attr("widid"),e.attr("widtype")))}});d=d.replace(/ui-draggable/g,"").replace(/ui-droppable/g,"");return d},ClearCell:function(){$("#mainTable").find("td").filter(function(){var a=$(this).css("background-color");return a==="#ADD8E6"||a==="rgb(173, 216, 230)"}).html("")},SetDefaultView:function(d){$target=$(d.target);var b=$target.hasClass("fa-square-o");var a=$target.closest("tr").find(".fldiv").text().trim();var c=BizAPP.ViewCustomization.Container.attr("bizapp_eid");realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["SetDefaultView",c,b,a,"true"],true,function(g,h,f){var e=BizAPP.UI._handleEventsAndExceptions(g,h,f);$target.closest(".list-views").find(".fa-check-square-o").removeClass("fa-check-square-o").addClass("fa-square-o");if(b){$target.removeClass("fa-square-o").addClass("fa-check-square-o")}})},LoadPersonalizedView:function(h,d){var b=$(h.target),j=b.closest("[bizapp_name].ViewControlEx");var a=j.attr("bizapp_eid");var k=j.attr("bizappid");var g=j.attr("bizapp_context").split("\n")[0];var f="";if(!d){f=b.closest("tr").find(".fldiv").text().trim()}var c=j;BizAPP.ViewCustomization.g_viewname=f;BizAPP.ViewCustomization.RefreshView(a,k,c,f,g)},Highlight:function(c,b){var a=$(c.target);if(b){a.css("border-bottom","2px dotted #456A90")}else{a.css("border-bottom","")}},ShowOptions:function(a){$(".ViewCustomAction .viewname").css("display","none");if(a&&$(a.target).hasClass("fa-edit")){$(".ViewCustomAction .remove").css("display","inline")}$(".ViewCustomAction .name").css("display","inline");if(g_hasSysAdminResp||g_hasAppAdminResp){$(".ViewCustomAction .showtoall").css("display","inline-block")}$(".ViewCustomAction .bcv-is").css("display","inline-block");$(".ViewCustomAction .save").css("display","inline");$(".ViewCustomAction .cancel").css("display","inline");$(".ViewCustomAction .available-ctrl-list").css("display","inline")},LoadWidgetManager:function(){BizAPP.ViewCustomization.LoadWidgetView(".widget-manager-list",function(){$(".widget-manager-list").find("[bza_data]").show()})},LoadDesignView:function(c,a,b){$("#bza-custom-view").remove();BizAPP.ViewCustomization.Container=$("#reportdesign");BizAPP.ViewCustomization.LoadDependency(function(){BizAPP.ViewCustomization.LoadControlListAndTable(c,true,true,a,b);$(".secondary").find("#vctab1").hide();BizAPP.ViewCustomization.LoadWidgetList(function(){$(".ViewCustomAction .fa-save,.ViewCustomAction .fa-close").hide();$(".ViewCustomAction .fa-thumbs-up,.ViewCustomAction .fa-refresh").show()})})},LoadWidgetList:function(a){BizAPP.ViewCustomization.LoadWidgets(".widget-list",function(){BizAPP.ViewCustomization.ToggleActiveTab("vctab2");if(!jQuery.ui){$.getScript(BizAPP.UI.GetBasePath("Resources/Javascripts/JQuery/jquery-ui.js"))}});BizAPP.ViewCustomization.LoadGlobalWidgets(".globalwidget-list",function(){$(".bcv-btn-group").append($(".ViewCustomAction").css("display","inline"));if(a){a()}closeMenuPopup()})},LoadControlListAndTable:function(p,o,f,s,d,q,n,t){f=f||false;var c='<div class="bza-vc-grid">			                                <style id="bza-vc-style">				                                .bza-vc-grid-item, .bzaw1 { width: 250px; }                                                .bzaw2 { width: calc((250px * 2) + 10px); }                                                 .bzaw3 { width: calc((250px * 3) + (10px * 2)); }                                        </style>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                        <div class="bza-vc-grid-item"><div class="bza-vc-boxed"></div></div>                                    </div>';var l='<div id="bza-custom-view" style="clear: both;">                            <style>.pckry_container .bza-vc-grid-item:hover { cursor: move; }.pckry_container .bza-vc-boxed:hover { background: aliceblue; }</style>                            <ul class="tbar global"><li id="vctabLayout" page="vcpageLayout" class="tbn tbact" onclick="BizAPP.ViewCustomization.LoadWidgetList();BizAPP.ViewCustomization.ToggleActiveTab(this.id, true);">Layout</li><li id="vctabWidget" page="vcpageWidget" class="tbn" onclick="BizAPP.ViewCustomization.LoadWidgetManager();BizAPP.ViewCustomization.ToggleActiveTab(this.id, true);">Widget Manager</li></ul>		                    <div id="vcpageLayout" rettab="true" class="tp" style="display: block;"><table style="width:100%;"><tr ><td><div class="btn-toolbar">                                <div class="bcv-btn-group" style="padding: 5px;"></div>                            </div></td><td class="bza-help-link" style="text-align: center;"><span style="color:#123f76;font-weight:bold;">{1}</span></td><td></td></tr>		                    <tr><td style="width:99%" colspan="2"><div id="myContainer1">		                    	{0}		                    </div></td>	                      <td style="width:14%;vertical-align:top;display:none;">                            <ul class="tbar secondary">                            <li id="vctab2" page="vcpage2" class="tbn tbact" onclick="BizAPP.ViewCustomization.ToggleActiveTab(this.id);">Widgets</li>                            <li id="vctab3" page="vcpage3" class="tbn" onclick="BizAPP.ViewCustomization.ToggleActiveTab(this.id);">Widget Controls</li>                            <li id="vctab4" page="vcpage4" class="tbn" onclick="BizAPP.ViewCustomization.ToggleActiveTab(this.id);">Global Widgets</li>                            <li id="vctab1" page="vcpage1" class="tbn" onclick="BizAPP.ViewCustomization.ToggleActiveTab(this.id);">Controls</li></ul>                            <div id="vcpage1" rettab="true" class="tp"><div class="control-list-cont" style="float:right;height:430px;width:400px;margin-top:15px;overflow:auto">                            <div class="gridbox" hideindex="" subview="" processed="1" initcaption="1"><div class="grd"><div class="grid" >                            <table class="grid tablesaw-columntoggle" cellspacing="0" cellpadding="0" style="border-collapse:collapse;">                            <tbody><tr valign="top" class="multiselect ui-draggable"><td><div class="fill">                            <table ecols="" cellspacing="0" cellpadding="0" class="gridcontrol tablesaw tablesaw-columntoggle"><thead>                            <tr class="bza_vdg_header"><th class="gridsortnone tablesaw-priority-2" sortid="Name" data-priority="2" style="padding-left: 20px;">Name</th>                            </tr></thead><tbody><tr class="gfr"><td >                            <div class="control-list"></div></td></tr></tbody></table></div></td></tr></tbody></table></div></div></div></div></div>                            <div id="vcpage2" rettab="true" class="tp"><div class="widget-list" style="float:right;height:430px;width:400px;margin-top:5px;overflow:auto"></div></div>                            <div id="vcpage3" rettab="true" class="tp"><div class="widgetcontrol-list-cont" style="float:right;height:430px;width:400px;margin-top:15px;overflow:auto">                            <div class="gridbox" hideindex="" subview="" processed="1" initcaption="1"><div class="grd"><div class="grid" >                            <table class="grid tablesaw-columntoggle" cellspacing="0" cellpadding="0" style="border-collapse:collapse;">                            <tbody><tr valign="top" class="multiselect ui-draggable"><td><div class="fill">                            <table ecols="" cellspacing="0" cellpadding="0" class="gridcontrol tablesaw tablesaw-columntoggle"><thead>                            <tr class="bza_vdg_header"><th class="gridsortnone tablesaw-priority-2" sortid="Name" data-priority="2" style="padding-left: 20px;">Name</th>                            </tr></thead><tbody><tr class="gfr"><td >                            <div class="widgetcontrol-list"></div></td></tr></tbody></table></div></td></tr></tbody></table></div></div></div></div></div>                            <div id="vcpage4" rettab="true" class="tp"><div class="globalwidget-list" style="float:right;height:430px;width:400px;margin-top:15px;overflow:auto"></div></div>                            </td></tr></table></div>                        <div id="vcpageWidget" rettab="true" class="tp" style="display: none;">                            <table style="width: 100%;"><tr><td>                                <div id="WidgetDrilldownContainer" class="widget-manager-drilldown"></div></td>                                <td style="vertical-align: top;"><div class="widget-manager-list"></td></tr></table></div>                        <div id="vcpagePreview" rettab="true" class="tp" style="display: none;">                            <div class="preview-cust-view"></div>                        </div></div>';var k=$("#reportdesign .bza-vc-grid").length>0;l=l.format(o?k?$("#reportdesign").html():c:"","");var a=BizAPP.ViewCustomization.Container;a.html($(l));BizAPP.ViewCustomization.AddActions("");if(s){var b='<a tabindex="-1" target="_blank" href="{0}" style="font-size:1.1rem;padding-left: 10px;" title="Help"><i class="fa fa-question-circle"></i></a>'.format(s);a.find(".bza-help-link").append(b)}if(f){var h=$("#reportlayout").find("table");if(h.hasClass("customized-view")){BizAPP.ViewCustomization.LoadWidgetsFromLayout(h);$("#mainTable").html(h.html())}if($(".available-ctrl-list").length==0){$(".lnksave").closest("tr").append('<td><span class="stepcenternormal cancel fa fa-refresh" id="cancel" onclick="$(\'.bza-vc-grid\').packery()" style="display:none;margin-left:2px;float:right" title="Relayout"></span><span class="available-ctrl-list popup-container tbdd cem_child last bzapp" style="float:right;width: 130px;padding: 5px!important;margin-top: 10px;" onclick="BizAPP.ViewCustomization.ShowAvailableControls(event);"><table cellspacing="0" cellpadding="0"><tbody><tr><td><span style="padding:0 2px;color:black;">Available Controls</span></td><td><i class="fa fa-sort-desc" style="font:normal normal normal 16px/1 FontAwesome;position:relative;top:-2px;"></i></td></tr></tbody></table></span></td>')}else{$(".available-ctrl-list").show()}BizAPP.ViewCustomization.ToggleActiveTab("vctab2");BizAPP.UI.Packery.Init()}else{if(o){BizAPP.ViewCustomization.InitMenuBar(p,"",function(){BizAPP.ViewCustomization.ToggleActiveTab("vctab2");BizAPP.UI.Packery.Init()})}else{var r=BizAPP.ViewCustomization.Container.attr("bizapp_eid");var j=BizAPP.ViewCustomization.Container.attr("bizappid");var u=BizAPP.ViewCustomization.Container.attr("bizapp_context").split("\n")[0];var g=$(p.target).closest("tr").find(".fldiv").text().trim();var m=$("#myContainer1");$("#chk-defaultview").prop("checked",n);$("#chk-showtoall").prop("checked",t);$("#chk-instancespecific").prop("checked",q);$(".bcv-is").hide();BizAPP.ViewCustomization.RefreshView(r,j,m,g,u,function(){setTimeout(function(){BizAPP.ViewCustomization.InitMenuBar(p,g,function(){BizAPP.UI.Packery.Init()})},1000)})}}},ShowAvailableControls:function(f){var b="<span>{0}</span>".format("Available Controls");var g='<div id="available-ctrls" class="available-ctrls" style="color: black;"><table><tr><td></td></tr></table></div>';var d='<div><table cellspacing="0" cellpadding="0" align="Left" style="border-collapse:collapse;"><tbody><tr valign="top"><td valign="middle" style="padding:2px;"><div onmouseover="highlightstep(this);" onmouseout="normalizestep(this);" style="height:100%;width:100%;"><span accesskey="C" class="stepcenternormal cancelstep" onclick="zoomout();">Close</span></div></td></tr></tbody></table></div>';var a={headline:b,body:g,steps:d};var c=BizAPP.UI.InlinePopup.GetMarkupWithTemplate(a);BizAPP.MenuPopup.Create({html:g,selector:$(".available-ctrl-list").find("span"),mode:"open",position:"bottom",callback:function(){f.stopPropagation();BizAPP.ViewCustomization.PopulateAvailableControls(f);$(".available-ctrl-list").removeAttr("onclick")}})},PopulateAvailableControls:function(a){addLog("PopulateAvailableControls");if(!$("#available-ctrls").find("ul.secondary").length){$("#available-ctrls td").append($("ul.secondary").closest("td").html())}$(a.target).find(".dropdown-menu.bottom").show();BizAPP.ViewCustomization.CleanUpGrid()},LoadWidgetsFromLayout:function(a){a.removeClass("bcv-tbl");a.find("tr").removeClass("bcv-tbl-row");a.find("td").removeClass("bcv-tbl-col");var b=a.find(".bcv-cont");if(b.length==0){b=a.find("td")}b.each(function(){var e=$(this);var c=$(e.find("[widid],[defeid]"));c.filter("*").contents().each(function(){if(this.nodeType==8){$(this).remove()}});if(c.is("[widname]")){c.text(c.attr("widname"))}else{var d=c.attr("title1");if(!d){d=c.attr("title")}c.text(d)}if(e.is(".bcv-cont")){e=e.closest("td")}e.html(c);e.prepend(BizAPP.ViewCustomization.GetIconHtml(c.attr("widtype")))})},ToggleActiveTab:function(e,b){var c=$("#bza-custom-view, .available-ctrls").find(".{0} .tbact".format(b?"global":"secondary"));var d=c.attr("page");$("#bza-custom-view, .available-ctrls").find("#"+d).hide();c.removeClass("tbact");var a=$("#"+e).attr("page");$("#bza-custom-view, .available-ctrls").find("#"+a).show();$("#bza-custom-view, .available-ctrls").find("#"+e).addClass("tbact")},LoadPersonizableControl:function(){var a=BizAPP.ViewCustomization.Container.attr("bizapp_eid");realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["GetPersonalizableControls",a],true,function(f,d,l){var e=BizAPP.UI._handleEventsAndExceptions(f,d,l);var m=$.parseJSON(e[1]);var g=Object.keys(m);for(i=0;i<g.length;i++){var c=g[i].split("[SEP]")[0];var h=g[i].split("[SEP]")[1];var b=g[i].split("[SEP]")[2];var j=BizAPP.ViewCustomization.GetIconHtml(h);if(b=="Control"){$(".control-list").append($('<div class="bvc-ctrl-nm">'+j+'<span title1="'+c+'" defeid= "'+m[g[i]]+'" widtype= "'+h+'" style="white-space:nowrap;overflow: hidden;text-overflow:ellipsis;cursor:pointer;">'+c+'</span></div><hr style="margin-bottom:5px;margin-top:0px;"/>'))}else{var k=b.split("[NS]")[1];$(".widgetcontrol-list").append($('<div class="bvc-widget-nm">'+j+'<span title1="'+k+'" defeid= "'+m[g[i]]+'" widtype= "'+h+'" widname= "'+c+'" style="white-space:nowrap;overflow: hidden;text-overflow:ellipsis;cursor:pointer;">'+k+'</span></div><hr style="margin-bottom:5px;margin-top:0px;"/>'))}}if(!$(".control-list").html()){$(".secondary").find("#vctab1").hide()}if(!$(".widgetcontrol-list").html()){$(".secondary").find("#vctab3").hide()}})},LoadWidgets:function(a,g){var f=$(a).closest("[bizapp_name].ViewControlEx").attr("bizappid");var d="ESystemaebec";var b="viewDataGrid2";var e=$(a);var c={viewdef:d,controlname:b,context:"",viewname:f,selector:e,callback:g};BizAPP.UI.LoadControl(c)},LoadGlobalWidgets:function(a,g){var f=$(a).closest("[bizapp_name].ViewControlEx").attr("bizappid");var d="ESystemb3b79";var b="vdg_allWidgets";var e=$(a);var c={viewdef:d,controlname:b,context:"",viewname:"",selector:e,callback:g};BizAPP.UI.LoadControl(c)},LoadWidgetView:function(a,b){BizAPP.UI.LoadView({url:"uiview.asmx?html.args=runtimeviewenterpriseid[NVS]ESystemb217f&html.jar=true",selector:$(a),callback:function(){b()}})},CleanUpGrid:function(){var a=$(".bza-dropdown .widget-list div.grid, .bza-dropdown .globalwidget-list div.grid").not(".bza-vc-cleanupgrid");addLog("CleanUpGrid "+a.length);if(a.length){a.addClass("bza-vc-cleanupgrid");a.find("table.gpr").closest("tr").remove();$(".widget-list .gridcontrol tr[roid], .globalwidget-list .gridcontrol tr[roid]").each(function(){var g=$(this).closest(".globalwidget-list").length;if(!g){var f=$(this).find("td:eq(4)");var e=f.text().split(".");f.text(e[e.length-1]);$(".widget-list .gridcontrol th:eq(1)").text("")}var j,h;if(g){j=$(this).find("td:eq(0)");h="Custom"}else{j=$(this).find("td:eq(1)");h=j.text()}j.html(BizAPP.ViewCustomization.GetIconHtml(h))});BizAPP.ViewCustomization.EnableDragAndDrop()}},GetIconHtml:function(b){var a="";switch(b){case"Grid":a='<span class="bcv-icon fa-table" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin-right: 5px;" title="Grid"></span>';break;case"BizAPP.Modeler.FormDesigner.Controls.ViewDataGrid":a='<span class="bcv-icon fa-table" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin: 4px 5px 0 0;" title="Grid"></span>';break;case"Advanced List":a='<span class="bcv-icon fa-th-list" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin-right: 5px;" title="Advanced List"></span>';break;case"BizAPP.Modeler.FormDesigner.Controls.AdvancedListControl":a='<span class="bcv-icon fa-th-list" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin: 4px 5px 0 0;" title="Advanced List"></span>';break;case"Chart":a='<span title="Chart" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin-right: 5px;" class="bcv-icon fa-bar-chart"></span>';break;case"BizAPP.Modeler.FormDesigner.Controls.ChartControl":a='<span title="Chart" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin: 4px 5px 0 0;" class="bcv-icon fa-bar-chart"></span>';break;case"Custom":a='<span title="Custom" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin-right: 5px;" class="bcv-icon fa-cog"></span>';break;case"BizAPP.Modeler.FormDesigner.Controls.HTMLControl":a='<span title="Custom" style="font: normal normal normal 14px/1 FontAwesome;float: left;margin: 4px 5px 0 0;" class="bcv-icon fa-cog"></span>';break}return a},LoadDependency:function(a){if(typeof REDIPS!="undefined"){if(a){a()}}else{$.getCss(BizAPP.UI.GetBasePath("Resources/ViewCustomization/combined.132.css"));BizAPP.UI.TextEditor.LoadFontAwesomeCss();$.cachedScript(BizAPP.UI.GetBasePath("Resources/ViewCustomization/combined.132.js")).done(function(){if(a){a()}})}},EnableDragAndDrop:function(){addLog("register dnd");$(".control-list div, .widgetcontrol-list div, .widget-list tr, .globalwidget-list tr").not(".ui-draggable").draggable({containment:$("#myContainer1 .bza-vc-grid"),opacity:0.7,cursor:"move",cursorAt:{top:-5,left:-5},zIndex:10000,helper:"clone",create:function(){addLog("dnd created")},start:function(){addLog("start dnd");var b=$(".ui-draggable-dragging");$("body").append(b);var a=document.getElementById("tooltip-span");window.onmousemove=function(d){var c=d.clientX,f=d.clientY;b.get(0).style.top=(f+10)+"px";b.get(0).style.left=(c+10)+"px"};if(isFirefox()){$(".available-ctrl-list .dropdown-menu.bottom").css("position","absolute").css("left","1000px")}else{closeMenuPopup()}},});$("#myContainer1 .bza-vc-boxed").not(".ui-droppable").droppable({drop:function(a,b){addLog("stop dnd");var c=$(this);if(c.find(".bcv-preview-cont").length){if(confirm("Do you want to replace existing widget/control in this cell?")){BizAPP.ViewCustomization.InternalDrop(a,b,c)}}else{BizAPP.ViewCustomization.InternalDrop(a,b,c)}if(isFirefox()){$(".available-ctrl-list .dropdown-menu.bottom").css("position","").css("left","")}}})},InternalDrop:function(r,n,c){if($(".control-list, .widgetcontrol-list").is(":visible")){c.append($(n.draggable).clone().html());var a=c.append('<div class="bcv-preview-cont"><div class="bcv-preview"></div><div class="bcv-overlay"></div></div>').find(".bcv-preview");var g=$(this);var k=$(n.draggable).find("[defeid]");var p=$(".stepcenternormal.save").closest("[bizapp_name].ViewControlEx").attr("bizappid");var f=k.attr("defeid");var h;if($(".widgetcontrol-list").is(":visible")){h=k.attr("widname")}else{h=k.attr("title1")}var d={viewdef:f,controlname:h,context:c.closest("[bizapp_context]").attr("bizapp_context").split("\n")[0],viewname:p,selector:a};BizAPP.UI.LoadControl(d)}else{var v,m,u;if(n.draggable.is("td")){v=n.draggable.parent().attr("roid");m=n.draggable.text().trim()}else{var l=$(n.draggable).closest("table").find('th:contains("Name")').index();var o=l.toString();var j=$(".globalwidget-list").is(":visible");v=n.draggable.attr("roid");m=n.draggable.find("td:eq({0})".format(o)).text().trim();if(j){u=n.draggable.find("td:eq({0})".format(l+1)).text()}else{u=n.draggable.find("td:eq({0})".format(o)).find("[caption]").attr("caption")}}var t=n.draggable.find("td:eq({0})".format(l-1));var s;if(t.find("div").length){s=t.find("div").attr("title1")}else{s=t.find("span").attr("title")}var b;if(j){b="globalwidget:"+v.split(":")[0]}else{b="widget:"+v.split(":")[0]}c.append('<div title1="{3}" widId="{1}" widName="{0}" widType="{2}">{0}</div>'.format(m,b,s,u?u:""));var e;if(j){e=v.split(":")[0]}else{e=$(".stepcenternormal.save").closest("[bizapp_name].ViewControlEx").attr("bizapp_eid")}var a=c.prepend('<div class="bcv-preview-cont"><div class="bcv-preview" id="chartWidget'+v.split(":")[0]+'"></div><div class="bcv-overlay"></div></div>').find(".bcv-preview");var q=$(".stepcenternormal.save").closest("[bizapp_name].ViewControlEx");var d={vieweid:e,context:q.attr("bizapp_context").split("\n")[0],vcn:q.attr("bizappid"),selector:a,widget:v.split(":")[0]};if(j){BizAPP.UI.LoadGlobalWidget(d)}else{BizAPP.UI.LoadWidget(d)}}c.children("span, div").not(".bcv-preview-cont").hide()},IsEligibleToMerge:function(d){var a=false;var g=d.cell.view.dom;if(d.colspan>1){var b=g;for(var c=1;c<d.colspan;c++){b=b.next();if(b.find("[widId],[defeid]").length&&g.find("[widId],[defeid]").length){a=confirm("Content will be lost")==true?true:false;break}else{if(d.colspan==c+1){a=!a?true:false}}var f=b.find("[widId],[defeid]");if(a&&f){g.append(f)}}}else{if(d.rowspan>1){var b=g;for(var c=1;c<d.rowspan;c++){var e=g.parent().next();b=e.find("td:eq("+g.index()+")");if(b.find("[widId],[defeid]").length&&g.find("[widId],[defeid]").length){a=confirm("Content will be lost")==true?true:false;break}else{if(d.rowspan==c+1){a=!a?true:false}}var f=b.find("[widId],[defeid]");if(a&&f){g.append(f)}}}else{a=true}}return a},ClearSelectedControls:function(){var a=$(".selected");a.find("[widId],[defeid]").remove()},RefreshView:function(d,c,b,e,a,f){BizAPP.UI.LoadView({url:"uiview.asmx?html.args=runtimeviewenterpriseid[NVS]"+d+"[PMS]runtimeobjectid[NVS]"+a+"[PMS]navigationcontrol.ignoreprocess[NVS]true&html.jar=true&html.vcn="+c+"&html.personalizedviewname="+e,selector:b,inlinePopup:false,showprocessing:true,callback:f})}};BizAPP.ViewCustomization.DynamicReport={_valueSet:"",Template:"",SubTemplate:"",currentParams:"",StringTemplate:'<td><span class="formfieldlabel" title="{2}">{0}</span></br><input type="text" class="dynamic-ctrl formtextbox" title="{2}" name="{0}" value="{1}"/></td>',DateTimeTemplate:'<td><span class="formfieldlabel" title="{3}">{0}</span></br><input type="text" id="{1}" class="dynamic-ctrl" title="{3}" bizappid="{1}" name="{0}" value="{2}"/></td>',AllowedValueSingleSelectionTemplate:'<td><span class="formfieldlabel" title="{3}">{0}</span></br><select  class="dynamic-ctrl formcombobox" title="{3}" bizappid="{1}" name="{0}"><option value="">&nbsp;</option>{2}</select></td>',AllowedValueMultiSelectionTemplate:'<td><span class="formfieldlabel" title="{3}">{0}</span></br><div class="dynamic-chkbox-list dynamic-ctrl" name="{0}"><table><tr>{2}</tr></table></div></td>',QueryTemplate:'<td><span class="formfieldlabel" title="{2}">{0}</span></br><input type="text" title="{2}" class="dynamic-ctrl formtextbox {6}" style="margin-bottom: 0px;" name="{0}" bza_qid="{4}" bza_fields="{3}" bza_valuefield="{5}" bza_value="" value="{1}" autocomplete="off" placeholder="type for suggestions"/></td>',_drilldownReport:"",Execute:function(d){if(BizAPP.ViewCustomization.DynamicReport._designmode){$(".linkAddToMyFavourites, .linkRemoveFromFavourites").hide();if($(".lnksave").length==0){$('<td><div class="stepcenternormal save lnkbtn lnksave" onclick="BizAPP.ViewCustomization.SaveDynamicReportDesign(true);"><div>Save</div></div></td>').insertBefore($(".linkBack").closest("td"))}}BizAPP.ViewCustomization.DynamicReport.Template="<style>";BizAPP.ViewCustomization.DynamicReport.Template+="                .report-parms td {";BizAPP.ViewCustomization.DynamicReport.Template+="                    padding: 0 10px;";BizAPP.ViewCustomization.DynamicReport.Template+="                }";BizAPP.ViewCustomization.DynamicReport.Template+="";BizAPP.ViewCustomization.DynamicReport.Template+="                select.formcombobox {";BizAPP.ViewCustomization.DynamicReport.Template+="                    min-width: 214px;";BizAPP.ViewCustomization.DynamicReport.Template+="                }";BizAPP.ViewCustomization.DynamicReport.Template+="";BizAPP.ViewCustomization.DynamicReport.Template+="                .report-options .lnkbtn {";BizAPP.ViewCustomization.DynamicReport.Template+="                    margin: 0 30px;";BizAPP.ViewCustomization.DynamicReport.Template+="                }";BizAPP.ViewCustomization.DynamicReport.Template+="                .dynamic-report-params td {vertical-align: top;}";BizAPP.ViewCustomization.DynamicReport.Template+="                .stepcontainer {";BizAPP.ViewCustomization.DynamicReport.Template+="                    border-top: solid 2px black;";BizAPP.ViewCustomization.DynamicReport.Template+="                    margin: 5px;";BizAPP.ViewCustomization.DynamicReport.Template+="                    padding-top: 5px;";BizAPP.ViewCustomization.DynamicReport.Template+="                }";BizAPP.ViewCustomization.DynamicReport.Template+="            </style>";BizAPP.ViewCustomization.DynamicReport.Template+='            <div class="report-parms" style="width: 550px;">';BizAPP.ViewCustomization.DynamicReport.Template+="                <div>";BizAPP.ViewCustomization.DynamicReport.Template+='                    <table width="100%" cellspacing="0" cellpadding="0">';BizAPP.ViewCustomization.DynamicReport.Template+="                        <tr>";BizAPP.ViewCustomization.DynamicReport.Template+='                            <td width="100%">';BizAPP.ViewCustomization.DynamicReport.Template+='                                <table style="width: 100%;">';BizAPP.ViewCustomization.DynamicReport.Template+="                                    <tbody>";BizAPP.ViewCustomization.DynamicReport.Template+="                                        <tr>";BizAPP.ViewCustomization.DynamicReport.Template+='                                            <td><span class="pq_title" locstring="">Parameters</span></td>';BizAPP.ViewCustomization.DynamicReport.Template+='                                            <td style="vertical-align: bottom;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                <div style="float: right;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                    <select class="formcombobox dr-saved-params" onchange="BizAPP.ViewCustomization.DynamicReport.PopulateSavedParams();">';BizAPP.ViewCustomization.DynamicReport.Template+="                                                        ";BizAPP.ViewCustomization.DynamicReport.Template+="                                                    </select>";BizAPP.ViewCustomization.DynamicReport.Template+="                                                </div>";BizAPP.ViewCustomization.DynamicReport.Template+='                                            </td><td valign="middle" style="padding: 2px;width: 20%;"><table><tr><td style="padding: 2px;"><div onmouseover="highlightstep(this);" onmouseout="normalizestep(this);" style="height: 100%; width: 100%;"><span accesskey="C" class="stepcenternormal cancelstep" onclick="BizAPP.ViewCustomization.DynamicReport.UpdateReportParameter();">Update</span></div></td><td style="padding: 2px;"><div onmouseover="highlightstep(this);" onmouseout="normalizestep(this);" style="height: 100%; width: 100%; padding-right: 10px;"><span accesskey="C" class="stepcenternormal cancelstep" onclick="BizAPP.ViewCustomization.DynamicReport.RemoveReportParameter();">Remove</span></div></td></tr></table></td>';BizAPP.ViewCustomization.DynamicReport.Template+="                                        </tr>";BizAPP.ViewCustomization.DynamicReport.Template+="                                    </tbody>";BizAPP.ViewCustomization.DynamicReport.Template+="                                </table>";BizAPP.ViewCustomization.DynamicReport.Template+='                                <span class="pq_groupborder"></span></td>';BizAPP.ViewCustomization.DynamicReport.Template+="                        </tr>";BizAPP.ViewCustomization.DynamicReport.Template+="                    </table>";BizAPP.ViewCustomization.DynamicReport.Template+="                </div>";BizAPP.ViewCustomization.DynamicReport.Template+='                {1}<div class="dynamic-report-params" style="max-height: 350px; overflow: auto;">';BizAPP.ViewCustomization.DynamicReport.Template+='                    <table style="padding: 0 20px;">';BizAPP.ViewCustomization.DynamicReport.Template+="                        <tr>{0}</tr>";BizAPP.ViewCustomization.DynamicReport.Template+="                    </table>";BizAPP.ViewCustomization.DynamicReport.Template+="                </div>";BizAPP.ViewCustomization.DynamicReport.Template+="                <div>";BizAPP.ViewCustomization.DynamicReport.Template+='                    <table width="100%" cellspacing="0" cellpadding="0">';BizAPP.ViewCustomization.DynamicReport.Template+="                        <tr>";BizAPP.ViewCustomization.DynamicReport.Template+='                            <td style="padding-top: 20px;"><span class="pq_groupborder"></span>';BizAPP.ViewCustomization.DynamicReport.Template+='                                <div style="float: right">';BizAPP.ViewCustomization.DynamicReport.Template+='                                    <table cellspacing="0" cellpadding="0" align="Left" style="border-collapse: collapse;">';BizAPP.ViewCustomization.DynamicReport.Template+="                                        <tbody>";BizAPP.ViewCustomization.DynamicReport.Template+='                                            <tr valign="top">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                <td valign="middle" style="padding: 2px;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                    <div style="height: 100%; width: 100%;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                        <input type="text" class="report-param-name" placeholder=" Name" style="width: 200px; margin-top: 8px;"></input>';BizAPP.ViewCustomization.DynamicReport.Template+="                                                    </div>";BizAPP.ViewCustomization.DynamicReport.Template+="                                                </td>";BizAPP.ViewCustomization.DynamicReport.Template+='                                                <td valign="middle" style="padding: 2px;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                    <div onmouseover="highlightstep(this);" onmouseout="normalizestep(this);" style="height: 100%; width: 100%; padding-right: 10px;"><span accesskey="C" class="stepcenternormal cancelstep" onclick="BizAPP.ViewCustomization.DynamicReport.SaveReportParameters();">Save</span></div>';BizAPP.ViewCustomization.DynamicReport.Template+="                                                </td>";BizAPP.ViewCustomization.DynamicReport.Template+='                                                <td valign="middle" style="padding: 2px;">';BizAPP.ViewCustomization.DynamicReport.Template+='                                                    <div onmouseover="highlightstep(this);" onmouseout="normalizestep(this);" style="height: 100%; width: 100%;"><span accesskey="S" class="stepcenternormal" onclick="BizAPP.ViewCustomization.DynamicReport.RunReport();" prevstate="normal">Run Report</span></div>';BizAPP.ViewCustomization.DynamicReport.Template+="                                                </td>";BizAPP.ViewCustomization.DynamicReport.Template+="                                            </tr>";BizAPP.ViewCustomization.DynamicReport.Template+="                                    </table>";BizAPP.ViewCustomization.DynamicReport.Template+="                                </div>";BizAPP.ViewCustomization.DynamicReport.Template+="                            </td>";BizAPP.ViewCustomization.DynamicReport.Template+="                        </tr>";BizAPP.ViewCustomization.DynamicReport.Template+="                    </table>";BizAPP.ViewCustomization.DynamicReport.Template+="                </div>";BizAPP.ViewCustomization.DynamicReport.Template+="            </div>";BizAPP.ViewCustomization.DynamicReport.SubTemplate="";var f=$('[bizapp_name="View_DynamicReportDetails_Drilldown"]');if(!BizAPP.ViewCustomization.DynamicReport._valueSet){BizAPP.ViewCustomization.DynamicReport._drilldownReport=f.attr("bizapp_context").split("\n")[0]}var c=BizAPP.Session.ExecuteQuery({queryEid:"ESystemb228f",contexts:f.attr("bizapp_context"),pageSize:20,pageNo:0,identifiersOnly:false,handleResponse:true});if(c.length){var b=new Array();$.each(c,function(k,n){var o="";if(k%2==0){o="</tr><tr>"}var l=n;var m=l["Value Type"];switch(m){case"String":BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.StringTemplate.format(l.Name,l["String Value"]?l["String Value"]:"",l.Description?l.Description:"");break;case"Date Time":var g="datepicker"+l.Name.replace(" ","");b.push(g+"[SEP]"+m);BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.DateTimeTemplate.format(l.Name,g,l["Date Time Value"]?l["Date Time Value"]:"",l.Description?l.Description:"");break;case"Allowed Values":var j="";var g="select"+l.Name.replace(" ","");var e=l["Is Single Selection"];if(e){$.each(l["Allowed Values"].split(","),function(p,q){j+='<option value="{0}">{0}</option>'.format(q)});BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.AllowedValueSingleSelectionTemplate.format(l.Name,g,j,l.Description?l.Description:"")}else{$.each(l["Allowed Values"].split(","),function(p,r){var q="";if(p%2==0){q="</tr><tr>"}j+='{2}<td><div><label><input type="checkbox" name="{1}" value="{0}">{0}</label></div></td>'.format(r,g,q)});BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.AllowedValueMultiSelectionTemplate.format(l.Name,g,j,l.Description?l.Description:"")}break;case"Query":var e=l["Is Single Selection"];if(e){var h=l["Query Id UniqueID"]?l["Query Id UniqueID"]:(l["Dynamic Query Id UniqueID"]?l["Dynamic Query Id UniqueID"]:"");BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.QueryTemplate.format(l.Name,l["Query Value"]?l["Query Value"]:"",l.Description?l.Description:"",l["Query Display Value Column"]?l["Query Display Value Column"]:"",h,l["Query Value Column"]?l["Query Value Column"]:"","ui-autocomplete-input")}else{var h=l["Query Id UniqueID"]?l["Query Id UniqueID"]:(l["Dynamic Query Id UniqueID"]?l["Dynamic Query Id UniqueID"]:"");BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.QueryTemplate.format(l.Name,l["Query Value"]?l["Query Value"]:"",l.Description?l.Description:"",l["Query Display Value Column"]?l["Query Display Value Column"]:"",h,l["Query Value Column"]?l["Query Value Column"]:"","ui-tageditor-input")}break;case"Date":var g="datepicker"+l.Name.replace(" ","");b.push(g+"[SEP]"+m);BizAPP.ViewCustomization.DynamicReport.SubTemplate+=o+BizAPP.ViewCustomization.DynamicReport.DateTimeTemplate.format(l.Name,g,l["Date Time Value"]?l["Date Time Value"]:"",l.Description?l.Description:"");break}});var a='<div class="parent-value-set" valueset="{0}"><table style="padding: 0 20px;"><tr><td><span class="formfieldlabel" title="Parent Report Parameters" style="margin: 10px 0;white-space: normal;">{1}</span></td></tr></table></div>'.format(BizAPP.ViewCustomization.DynamicReport._valueSet,BizAPP.ViewCustomization.DynamicReport._valueSet.replace(/\[VPNVS]/g,":<i>").replace(/\[VPPMS]/g,"</i> | "));BizAPP.ViewCustomization.DynamicReport.Template=BizAPP.ViewCustomization.DynamicReport.Template.format(BizAPP.ViewCustomization.DynamicReport.SubTemplate,a);BizAPP.ViewCustomization.DynamicReport.ListSavedParameters(function(){var e=$(".linkActualExecute");BizAPP.MenuPopup.Create({html:BizAPP.ViewCustomization.DynamicReport.Template,selector:e,mode:"open",position:"top",autodeleteonclose:true,callback:function(){$.each(b,function(j,g){var h=g.split("[SEP]");var k=h[1]=="Date"?"DatePicker":"ShowTimePicker";BizAPP.UI.DateTime.Init(h[0],"",k,30,'{"maxDate":"","minDate":""}')});BizAPP.ViewCustomization.DynamicReport._valueSet="";BizAPP.ViewCustomization.DynamicReport.RegisterAutoComplete();BizAPP.ViewCustomization.DynamicReport.TagEditorInit();if(BizAPP.ViewCustomization.DynamicReport.currentParams){BizAPP.ViewCustomization.DynamicReport.PopulateSavedParams(BizAPP.ViewCustomization.DynamicReport.currentParams);BizAPP.ViewCustomization.DynamicReport.currentParams=""}d.stopPropagation()}})})}else{if(BizAPP.ViewCustomization.DynamicReport._valueSet){$(".linkActualExecute").parent().hide()}BizAPP.ViewCustomization.DynamicReport.RunReport()}$(".dr-saved-reports").hide()},RegisterAutoComplete:function(){$.each($(".dynamic-ctrl.ui-autocomplete-input"),function(){BizAPP.UI.Textbox.EnhanceAutoComplete({value:$(this).attr("bza_fields"),selector:$(this),selectCallback:function(a,b){$(a.target).val(b.item.label);var c=$(a.target).attr("bza_valuefield");$(a.target).attr("bza_value",JSON.stringify([{label:b.item.label,value:b.item.addnData[$(a.target).attr("bza_valuefield")]}]));a.stopPropagation();BizAPP.ViewCustomization.DynamicReport.RegisterAutoComplete()},passValueSet:true})})},ListSavedParameters:function(b){var a=$('[bizapp_name="View_DynamicReportDetails_Drilldown"]').attr("bizapp_context").split(":")[0];realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["GetSavedDynamicReportParameters",a],false,function(f,h,d){var f=JSON.parse(f.value[1]);var e='<option value="" disabled="" selected="" hidden="">{0}</option>';$(".dr-saved-reports, .dr-saved-params").find("option").remove();$.each(f,function(k,j){e+='<option value="{0}" uid="{2}" valueset=\'{1}\'>{0}</option>'.format(j.Name,j.ValueSet,j.uniqueid)});$(".dr-saved-reports").append(e.format("Saved Reports.."));if($(".dr-saved-params").length){$(".dr-saved-params").append(e.format("Saved Parameters.."))}else{var g="";var c=$(BizAPP.ViewCustomization.DynamicReport.Template);c.find(".dr-saved-params").append(e.format("Saved Parameters.."));c.each(function(k,j){if(j&&j.outerHTML){g+=j.outerHTML}});BizAPP.ViewCustomization.DynamicReport.Template=g}b()})},SaveReportParameters:function(){var c=$(".report-param-name").val().trim();if(c){var b=$('[bizapp_name="View_DynamicReportDetails_Drilldown"]').attr("bizapp_context").split(":")[0];var a=BizAPP.ViewCustomization.DynamicReport.ConstructValueSet();realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["SaveDynamicReportParameter",c,b,a],true,function(e,f,d){BizAPP.ViewCustomization.DynamicReport.ListSavedParameters(function(){ProcessingStatus(false,true);$(".dr-saved-params").val(c);$(".report-param-name").val("")})})}else{alert("Name is mandatory")}},RemoveReportParameter:function(){var a=$(".dr-saved-params").find("option:selected").attr("uid");if(a){realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["RemoveDynamicReportParameter",a],true,function(c,d,b){BizAPP.ViewCustomization.DynamicReport.ListSavedParameters(function(){ProcessingStatus(false,true);$(".report-param-name").val("");$(".dynamic-ctrl").each(function(){var e=$(this);e.val("");if(e.hasClass("ui-autocomplete-input")||e.hasClass("ui-tageditor-input")){e.attr("bza_value","").attr("value","")}if(e.hasClass("dynamic-chkbox-list")){e.find('input[type="checkbox"]:checked').each(function(){$(this).prop("checked",false)})}})})})}},UpdateReportParameter:function(){var b=$(".dr-saved-params").find("option:selected").attr("uid");if(b){var a=BizAPP.ViewCustomization.DynamicReport.ConstructValueSet();realAjaxAsyncCall("ViewCustomizerEx",getNextRequestId(),["UpdateDynamicReportParameter",b,a],true,function(d,e,c){BizAPP.ViewCustomization.DynamicReport.ListSavedParameters(function(){ProcessingStatus(false,true);$(".dr-saved-params").val($(".dr-saved-params").find('option[uid="{0}"]'.format(b)).val())})})}},ConstructValueSet:function(){var c=new Array();var a="";$(".dynamic-ctrl").each(function(){var e=$(this);var d=e.val();if(d&&e.attr("bza_value")&&e.hasClass("ui-autocomplete-input")){d=e.attr("bza_value")}if(e.hasClass("ui-tageditor-input")&&e.attr("bza_value")){d=e.attr("bza_value")}if(e.hasClass("dynamic-chkbox-list")){d="";e.find('input[type="checkbox"]:checked').each(function(){d=d?d+","+$(this).val():$(this).val()})}c.push(e.attr("name")+"[VPNVS]"+d)});if(c.length){a=c.join("[VPPMS]")}var b=$(".parent-value-set").attr("valueset");if(!b&&BizAPP.ViewCustomization.DynamicReport._valueSet){b=BizAPP.ViewCustomization.DynamicReport._valueSet}b=b?b+"[VPPMS]":"";return b+a},PopulateSavedParams:function(a){if(!a){a=$(".dr-saved-params").find("option:selected").attr("valueset")}$.each(a.split("[VPPMS]"),function(e,b){var d=$('.dynamic-ctrl[name="{0}"]'.format(b.split("[VPNVS]")[0]));var f=b.split("[VPNVS]")[1];if(d.hasClass("ui-tageditor-input")){var c=d.tagEditor("getTags")[0].tags;for(e=0;e<c.length;e++){d.tagEditor("removeTag",c[e])}if(f.indexOf("{")!=-1){d.attr("bza_value",f);f=JSON.parse(f);$.each(f,function(){d.tagEditor("addTag",this.label)})}}else{if(d.hasClass("ui-autocomplete-input")){if(f.indexOf("{")!=-1){d.attr("bza_value",f);f=JSON.parse(f)[0].label}}}d.val(f)})},RunReport:function(){var a=$('[bizapp_name="View_DynamicReportDetails_Drilldown"]'),h=a.closest("[bizapp_name].ViewControlEx");var g=h.attr("bizapp_eid");var c=h.attr("bizappid")+":dynamicreport";var f=h.attr("bizapp_context").split("\n")[0];var e=a.attr("bizapp_context").split("\n")[0];var b=BizAPP.ViewCustomization.DynamicReport.ConstructValueSet();BizAPP.ViewCustomization.DynamicReport.currentParams=b;var d="runtimeviewenterpriseid[NVS]"+g+"[PMS]runtimeobjectid[NVS]"+f+"[PMS]navigationcontrol.ignoreprocess[NVS]true";realAjaxAsyncCall("ViewNavigationEx",getNextRequestId(),["PreviewView",d,c,"true","","false","",e,b,"false"],true,function(l,m,k){var j={selector:$(".report-data")};BizAPP.UI._handleSuccessResponse(l,m,k,j);BizAPP.ViewCustomization.DynamicReport._valueSet="";closeMenuPopup();if(BizAPP.ViewCustomization.DynamicReport._designmode){if($(".report-empty-layout").length>0){$(".report-empty-layout").attr("id","reportdesign");BizAPP.ViewCustomization.LoadDesignView(null,"","")}else{$(".bza-vc-grid").wrap('<div id="reportdesign"></div>');BizAPP.ViewCustomization.LoadDesignView(null,"","")}}})},LoadDrilldownView:function(a){var b="";if(a){b=$(".linkActualExecute").closest(".ViewControlEx").parent()}else{b=$($('[bizapp_name="View_DesignView"]').get(0)).parent()}BizAPP.UI.LoadView({url:"uiview.asmx?html.args=runtimeviewenterpriseid[NVS]ESystemb1e33[PMS]runtimeobjectid[NVS]"+BizAPP.ViewCustomization.DynamicReport._drilldownReport+"&html.jar=true&html.vcn="+b.attr("id")+":dummy",selector:b})},PopulateParentReportParameters:function(a){BizAPP.ViewCustomization.DynamicReport._valueSet=a},DrillDownReport:function(b){b.additionalparams=b.additionalparams||{};var a="";var f=new Array();$.each(b.additionalparams,function(h,g){f.push(h+"[VPNVS]"+g)});if(f.length){a=f.join("[VPPMS]")}valueset=BizAPP.ViewCustomization.DynamicReport.ConstructValueSet();if(a){valueset=a+"[VPPMS]"+valueset}b.selector=b.selector||'[id="{0}"]:first'.format(b.target);var e=$(b.selector);var d=b.report+":EIPMS8a7ec:-1";var c="runtimeviewenterpriseid[NVS]ESystemb1f4c[PMS]runtimeobjectid[NVS]"+d+"[PMS]navigationcontrol.ignoreprocess[NVS]true";realAjaxAsyncCall("ViewNavigationEx",getNextRequestId(),["PreviewView",c,b.target,"true","","false","","",valueset,"true"],true,function(j,k,h){var g={selector:e};BizAPP.UI._handleSuccessResponse(j,k,h,g);closeMenuPopup()})},TagEditorInit:function(){$.each($(".dynamic-ctrl.ui-tageditor-input"),function(){var a=$(this);if(a.next(".tag-editor").length<1){a.css("display","block").removeData("options").next(".tag-editor").remove();BizAPP.UI.TagEditor.LoadDependency(function(){a.attr("bza-tag","{}");a.tagEditor({initialTags:[],autocomplete:{minLength:0,source:function(e,c){var f=a;var b=f.attr("bza_fields"),d;if(f.attr("bza_qid")){d=["GetAutoCompleteSugestions",f.attr("bza_qid"),e.term,b,null,f.attr("bizapp_context"),BizAPP.ViewCustomization.DynamicReport.ConstructValueSet()]}else{if(f.attr("bizapp_context")){d=["GetAutoCompleteResults",f.attr("bizapp_context"),e.term,"",b,f.attr("bza_basefield")]}else{displayMessage("query or context is mandatory");return}}realAjaxAsyncCall("HelperEx",getNextRequestId(),d,false,function(j,k,h){j=BizAPP.UI._handleEventsAndExceptions(j,k,h);b=b.split(",");var g=null;if(f.attr("bza_qid")){g=$.map(JSON.parse(j[1]),function(m){var n="";if(b.length==1){n=m[b[0]]}else{$.each(b,function(){if(n){n+=", "}n+=this+" : "+m[this]})}var o=f.attr("bza_valuefield"),l;return{value:o?m[o]:m.uniqueid,label:n,status:m.Status,identifier:m.uniqueid+":"+m.objecttype+":-1"}})}else{g=$.map(JSON.parse(j[1]),function(l){return{value:l.label||l.value||l.Value,label:l.autocompletelabel||l.label||l.value||l.Value,identifier:l.value||l.Value}})}c(g)})},position:{collision:"flip"},select:function(b,c){addLog(c.item);$(b.target).val(c.item.label);var d;if(a.attr("bza_value")){d=JSON.parse(a.attr("bza_value"));d.push(c.item);d=JSON.stringify(d)}else{d=JSON.stringify([c.item])}a.attr("bza_value",d);a.attr("value",a.attr("bza_value"));$(b.target).blur();$(b.target).closest("ul").blur();b.stopPropagation()}},forceLowercase:false,onChange:function(d,c,b,f,e){a.val(b.toString());if(!b.toString()){a.attr("bza_value","").attr("value","")}},beforeTagSave:function(e,d,c,b,f){},beforeTagDelete:function(d,c,b,e){}});if(g_activeCtrl){$('[bizappid="'+g_activeCtrl+'"]').next().click();g_activeCtrl=null}$(".tag-editor").attr("style",a.attr("style")).show().addClass("formtextbox");$(".tag-editor").css("min-width",a.css("width")).css("width","auto").css("overflow","auto")})}else{a.hide()}})},LoadTagEditorDependency:function(a){$.cachedScript(BizAPP.UI.GetBasePath("Resources/TagEditor/jquery.tag-editor.js")).done(function(b,c){$.getCss(BizAPP.UI.GetBasePath("Resources/TagEditor/jquery.tag-editor.css"));setTimeout(a,10)})}};BizAPP.UI.Packery={LoadDependency:function(b){var a="Script.asmx?csn=bizapp&cn=packery&v="+__bts_;$.cachedScript(BizAPP.UI.GetBasePath(a)).done(function(c,d){if(b){b()}})},Init:function(a,b){BizAPP.UI.Packery.LoadDependency(function(){$("#myContainer1 .bza-vc-grid .bza-vc-boxed").each(function(){var d=$(this);if(d.find(".bza-menu-cont").length==0){BizAPP.UI.Packery._addCellOptions(d)}});if(!a){a=parseFloat($("#bza-vc-style").attr("width"));if(!a){a=250}}if(!b){b=10}$("#bza-vc-style").replaceWith(BizAPP.UI.AdvList._render('<style id="bza-vc-style" width="{{n}}">				.bza-vc-grid-item,.bzaw1{width:{{n}}px}				.bzaw2{width:calc(({{n}}px * 2) + {{i}}px)}				.bzaw3{width:calc(({{n}}px * 3) + ({{i}}px * 2))}				.bzaw4{width:calc(({{n}}px * 4) + ({{i}}px * 3))}				.bzaw5{width:calc(({{n}}px * 5) + ({{i}}px * 4))}				.bzaw6{width:calc(({{n}}px * 6) + ({{i}}px * 5))}			</style>',[{n:a,i:b}]));$(".bza-vc-grid").packery({itemSelector:".bza-vc-grid-item",gutter:b,columnWidth:a});var c=$(".bza-vc-grid").find(".bza-vc-grid-item").draggable();$(".bza-vc-grid").packery("bindUIDraggableEvents",c);$("#myContainer1 .bza-vc-grid-item").hover(function(){$(this).find(".bza-menu-cont").show()},function(){$(this).find(".bza-menu-cont").hide()})})},PackerySetup:function(){if($("#bza-vc-column").val()){$(".bza-vc-grid").packery("destroy");BizAPP.UI.Packery.Init(($(".bza-vc-grid").width()-50)/$("#bza-vc-column").val())}else{$(".bza-vc-grid").packery()}},_addCellOptions:function(a){a.append('<div class="bza-menu-cont" style="display: none">							<span class="bza-hover-menu fa fa-star-o" onclick="BizAPP.UI.Packery.AddNewItem();" title="create cell"/>							<span class="bza-hover-menu fa fa-trash-o" onclick="BizAPP.UI.Packery.Remove(event);" title="delete cell"/>							<span class="bza-hover-menu fa fa-minus fa-caret-up fa-minus-square-o" onclick="BizAPP.UI.Packery.DecreaseRow(event);" title="decrease height"/>							<span class="bza-hover-menu fa fa-plus fa-caret-down fa-plus-square-o" onclick="BizAPP.UI.Packery.IncreaseRow(event);" title="increase height"/>							<span class="bza-hover-menu fa fa-plus fa-caret-right fa-plus-square-o" onclick="BizAPP.UI.Packery.IncreaseColumn(event);" title="increase width"/>							<span class="bza-hover-menu fa fa-minus fa-caret-left fa-minus-square-o" onclick="BizAPP.UI.Packery.DecreaseColumn(event);" title="decrease width"/>						</div>						<div class="bza-resize-menu-cont" style="display: none">							Rows:<select class="bza-pckry-row" onchange="">								<option value="1">1</option>								<option value="2">2</option>								<option value="3">3</option>								<option value="4">4</option>							</select>							Columns:<select class="bza-pckry-col" onchange="">								<option value="1">1</option>								<option value="2">2</option>								<option value="3">3</option>								<option value="4">4</option></select>							<span class="stepcenternormal bza-pckry-rz" onclick="BizAPP.UI.Packery.Resize(event);" >OK</span>							<span class="stepcenternormal bza-pckry-rz-cancel" onclick="BizAPP.UI.Packery.CancelResize(event);">Cancel</span>						</div>')},GetRowValue:function(a){if(a.hasClass("bzaw2")){return 2}else{if(a.hasClass("bzaw3")){return 3}else{if(a.hasClass("bzaw4")){return 4}else{return 1}}}},GetColumnValue:function(a){if(a.hasClass("bzah2")){return 2}else{if(a.hasClass("bzah3")){return 3}else{if(a.hasClass("bzah4")){return 4}else{return 1}}}},ShowResizeDialog:function(b){var a=$(b.target).closest(".bza-vc-grid-item");a.find(".bza-pckry-col").val(BizAPP.UI.Packery.GetRowValue(a));a.find(".bza-pckry-row").val(BizAPP.UI.Packery.GetColumnValue(a.find(".bza-vc-boxed")));a.find(".bza-menu-cont").hide();a.find(".bza-resize-menu-cont").show()},CancelResize:function(b){var a=$(b.target).closest(".bza-vc-grid-item");a.find(".bza-resize-menu-cont").hide();a.find(".bza-menu-cont").show()},IncreaseColumn:function(b){var a=$(b.target).closest(".bza-vc-grid-item");var c=BizAPP.UI.Packery.GetRowValue(a);a.removeClass("bzaw1 bzaw2 bzaw3 bzaw4");a.addClass("bzaw"+(c+1).toString());setTimeout(BizAPP.UI.Packery.PackerySetup,500)},IncreaseRow:function(b){var a=$(b.target).closest(".bza-vc-grid-item");var c=BizAPP.UI.Packery.GetColumnValue(a);a.removeClass("bzah1 bzah2 bzah3 bzah4");a.addClass("bzah"+(c+1).toString());setTimeout(BizAPP.UI.Packery.PackerySetup,500)},DecreaseColumn:function(b){var a=$(b.target).closest(".bza-vc-grid-item");var c=BizAPP.UI.Packery.GetRowValue(a);if(c==1){return}a.removeClass("bzaw1 bzaw2 bzaw3 bzaw4");a.addClass("bzaw"+(c-1).toString());setTimeout(BizAPP.UI.Packery.PackerySetup,500)},DecreaseRow:function(b){var a=$(b.target).closest(".bza-vc-grid-item");var c=BizAPP.UI.Packery.GetColumnValue(a);if(c==1){return}a.removeClass("bzah1 bzah2 bzah3 bzah4");a.addClass("bzah"+(c-1).toString());setTimeout(BizAPP.UI.Packery.PackerySetup,500)},Resize:function(b){var a=$(b.target).closest(".bza-vc-grid-item");a.removeClass("bzaw1 bzaw2 bzaw3 bzaw4");a.addClass("bzaw"+a.find(".bza-pckry-col").val());a.removeClass("bzah1 bzah2 bzah3 bzah4");a.addClass("bzah"+a.find(".bza-pckry-row").val());BizAPP.UI.Packery.CancelResize(b);setTimeout(BizAPP.UI.Packery.PackerySetup,500)},Remove:function(b){var a=$("#myContainer1 .bza-vc-grid");a.packery("remove",$(b.target).closest(".bza-vc-grid-item"));a.packery("shiftLayout")},AddNewItem:function(){var b=$('<div class="bza-vc-grid-item"><div class="bza-vc-boxed bzah1"></div></div>');var a=$(".bza-vc-grid");a.append(b).packery("appended",b);b.draggable();a.packery("bindUIDraggableEvents",b);b.hover(function(){if(!$(".bza-resize-menu-cont").is(":visible")){$(this).find(".bza-menu-cont").show()}},function(){$(this).find(".bza-menu-cont").hide()});BizAPP.UI.Packery._addCellOptions(b.find(".bza-vc-boxed"))}};