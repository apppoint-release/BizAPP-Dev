/*!*
* Copyright (C) 2000 - 2011, AppPoint Software Solutions.
* The program code and other information contained herein are not for public use, 
* include confidential and proprietary information owned by AppPoint Software Solutions. 
* Any reproduction, disclosure, reverse engineering, in whole or in part, is prohibited 
* unless with prior explicit written consent of AppPoint Software Solutions. 
*
* This software is protected by local Copyright law, patent law, and international treaties.
* Unauthorized reproduction or distribution may be subject to civil and criminal penalties and is 
* strictly prohibited. Portions of this program code, documentation, processes, and information 
* could be patent pending.
* 
**/
var BizAPP=BizAPP||{};BizAPP.UI=BizAPP.UI||{};BizAPP.UI.Collaboration={template:'<section class="videoConference"><div class="videoConference-wrapper"><div class="videoConference-videoDispaly-container Left"><!--WhiteboardContainer--><!--MainVideoContainer--></div><div class="videoConference-menu-container Left videoConference-landingCol-same-height"><div class="videoConference-menu-Link-container Left" onclick="BizAPP.UI.Collaboration.ShowAttendees();"><div class="videoConference-menu-Link-img-container Left videoConference-sprite videoConference-sprite-Attendees" title="Attendees">&nbsp;</div><div class="videoConference-menu-Link-title-container Left">Attendees (<span class="videoConference-menu-Link-title-count">0</span>)</div></div><div class="videoConference-menu-Link-container Left" onclick="BizAPP.UI.Collaboration.ShowScreens();"><div class="videoConference-menu-Link-img-container Left videoConference-sprite videoConference-sprite-Screen" title="Screen">&nbsp;</div><div class="videoConference-menu-Link-title-container Left">Screen (<span class="videoConference-menu-Link-title-count">0</span>)</div></div><div class="videoConference-menu-Link-container Left" onclick="BizAPP.UI.Collaboration.ShowVideos();"><div class="videoConference-menu-Link-img-container Left videoConference-sprite videoConference-sprite-Sharing" title="Video" >&nbsp;</div><div class="videoConference-menu-Link-title-container Left">Video (<span class="videoConference-menu-Link-title-count">0</span>)</div></div><div class="videoConference-menu-Link-container Left" onclick="BizAPP.UI.Collaboration.ShowWhiteboard();"><div class="videoConference-Whiteboard-preview-container"><div id="draw-preview" style="background:white;"><canvas width="700" height="500" id="drawing-canvus-preview"  style="height:50px;width:75px;"></canvas></div></div><div class="videoConference-menu-Link-title-container Left">Whiteboard</div></div><div class="videoConference-submenu-container Left"><div class="videoConference-submenu-Link-container Left"><div class="videoConference-submenu-Link-img-container Left videoConference-sprite videoConference-sprite-Sharing" title="Sharing">&nbsp;</div><div class="videoConference-submenu-Link-title-container Left">Sharing (<span class="videoConference-submenu-Link-title-count">0</span>)</div></div></div>{2}</div><div class="videoConference-content-container Left videoConference-landingCol-same-height"><div class="videoConference-content-NavLinks-container" ><div class="videoConference-content-NavLinks-Link-container Left" style="display:none"><div class="videoConference-content-NavLinks-Link-img-container Left videoConference-sprite videoConference-sprite-AddUser" title="Add">&nbsp;</div></div><div class="videoConference-content-NavLinks-Link-container Left"><div class="videoConference-content-NavLinks-Link-img-container Left videoConference-sprite videoConference-sprite-Chat" title="Chat" onclick="BizAPP.UI.Collaboration.ShowChat()">&nbsp;</div></div><div class="videoConference-content-NavLinks-Link-container Left" style="display:none"><div class="videoConference-content-NavLinks-Link-img-container Left videoConference-sprite videoConference-sprite-Note" title="Artical">&nbsp;</div></div><div class="videoConference-content-NavLinks-Link-container Left" style="display:none"><div class="videoConference-content-NavLinks-Link-img-container Left videoConference-sprite videoConference-sprite-Setting" title="Setting">&nbsp;</div></div><div class="videoConference-content-NavLinks-Link-container Left"><div class="videoConference-content-NavLinks-Link-img-container Left videoConference-sprite-SharedFiles fa fa-2x fa-paperclip" title="Shared Files" onclick="BizAPP.UI.Collaboration.ShowSharedFiles()">&nbsp;</div><div class="videoConference-AlertCnt" style="display:none">0</div></div>{3}</div><div class="videoConference-content-MiddleContent-container" style="display:inline-block;" ><!--AttendeeContainer--><!--ChatContainer--><!--WebCamContainer--><!--ScreenContainer--><!--SharedFileContainer--><div class="bza-middle-container"><div id="extension-view-container"></div></div></div><!--SwitchMediaContainer--></div></div><div class="videoConference-footer" style="display:none"><div class="Left">COPYRIGHT &copy; 2015, ALL RIGHTS RESERVED</div><div class="Right"><span class="videoConference-font-blue">POWERED BY</span> BART</div></div></div></section>',_supportedMode:"audio+video+data+screen",connection:null,channel:"",DetectRTC:{},participants:[],reconnect:false,participantsToReconnect:"",sessionNotStartedMsgShown:false,allAttendees:"",selector:"",mainVideoContainer:'<div class="videoConference-mainVideo-container"><div class="videoConference-videoDispaly-holder-container Left"><div id="main-video-container" onclick="BizAPP.UI.Collaboration.StopEventPropagation(event)"><div id="webcam-container"></div></div></div><div class="videoConference-videoDispaly-Controls-container Left"><div class="videoConference-videoDispaly-Controls-wrapper Left"><div class="videoConference-videoDispaly-Controls-VideoTime-container Left">00:00:00</div><div class="videoConference-videoDispaly-Controls-VideoControls-container Right"><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoScreen" title="Screen" style="display:none">&nbsp;</div><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoPlay" title="Play" style="display:none">&nbsp;</div><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoPause" title="Pause" onclick="BizAPP.UI.Collaboration.PausePlayVideo(event);">&nbsp;</div><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoStop" title="Stop" style="display:none">&nbsp;</div><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoDisplayScreen" title="Display Screen" style="display:none">&nbsp;</div><div class="videoConference-videoDispaly-Controls-VideoControl-container Left videoConference-sprite videoConference-sprite-VideoZoomOutIn" title="Zoom Out" onclick="BizAPP.UI.Collaboration.ZoomOutVideo(event);">&nbsp;</div></div></div></div></div><div id="extension-mainView-container" class="videoConference-customView-container" style="display: none;">',attendeesContainer:'<div id="attendees-container" class="bza-middle-container"><div class="videoConference-content-Title-container Left videoConference-blue-font-color Font-Size-18">Attendees</div><div class="videoConference-content-SearchBox-container Left" style="display:none"><div class="videoConference-content-SearchBox-TextBox-container Left"><input type="text" class="videoConference-content-SearchBox-TextBox"/></div><div class="videoConference-content-SearchBox-SearchIcon-container Left Cursor-Pointer videoConference-sprite videoConference-sprite-Search" title="Contact Us">&nbsp;</div></div><div class="attendees-list-container"></div></div>',chatContainer:'<div id="chat-container" class="bza-middle-container" style="display: none;"><div class="videoConference-content-mainchat-container Left"><div class="videoConference-content-mainchat-tab-container Left"><div class="videoConference-content-mainchat-tab-livechat-container Left videoConference-content-mainchat-tab-livechat-Active"><div class="videoConference-mainchat-tab-ChatIcon-container Left videoConference-sprite videoConference-sprite-Chat"><div class="videoConference-mainchat-tab-ChatUser-status Left ChatUser-status-Active">&nbsp;</div></div><div class="videoConference-mainchat-tab-ChatCount-container Left">LIVE CHAT(<span class="videoConference-mainchat-tab-ChatCount">0</span>)</div></div><div class="videoConference-content-mainchat-tab-attendeeschat-container Left"><div class="videoConference-mainchat-tab-ChatIcon-container Left videoConference-sprite videoConference-sprite-Attendees-User">&nbsp;</div><div class="videoConference-mainchat-tab-ChatCount-container Left">(<span class="videoConference-mainchat-tab-ChatCount">0</span>)</div></div></div><div class="videoConference-content-mainchat-tab-strip-container"><div class="videoConference-content-mainchat-tab-strip  videoConference-content-mainchat-tab-livechat-strip tab-strip-Active">&nbsp;</div><div class="videoConference-content-mainchat-tab-strip videoConference-content-mainchat-tab-attendeeschat-strip">&nbsp;</div></div><div class="videoConference-content-mainchat-tabcontent-container Left"><div class="videoConference-content-mainchat-tabcontent-livechat-container Left"><div class="videoConference-content-mainchat-tabcontent-livechat-groupchat-container Left"><div class="videoConference-content-mainchat-tabcontent-livechat-groupchat-body-container Left"><div id="chat-output" class="videoConference-chatting-content-container Left"></div></div><div class="videoConference-chatting-content-EditBox-container Left"><div class="videoConference-chatting-content-EditBox-Textarea-container Left"><textarea id="chat-input" class="videoConference-chatting-content-EditBox-Textarea" placeholder="Type here..." disabled></textarea></div><div class="videoConference-chatting-content-EditBox-SendIcon-container Right videoConference-sprite videoConference-sprite-RightBlueArrow Cursor-Pointer" onclick="BizAPP.UI.Collaboration.SendMessage();">&nbsp;</div></div><div class="videoConference-chatting-file-attachment-container Left"><div id="drag-and-drop-zoneWebRTC" class="uploader" style="display: inline-block;border: 0;"><div class="videoConference-chatting-file-attachment-icon-container Left"><div class="browser"><table><tr><td class="uploader-btn"><label><div class="videoConference-chatting-content-EditBox-SendIcon-container Right videoConference-sprite videoConference-sprite-Attachment Cursor-Pointer" title="Browse Files">&nbsp;<input type="file" ID="uploader"></div></label></td></tr></table></div></div><div class="videoConference-chatting-file-attachment-content-container Left"><div class="videoConference-chatting-file-attachment-content-icon-container Left"><div class="videoConference-chatting-content-EditBox-SendIcon-container Right videoConference-sprite videoConference-sprite-DragMove Cursor-Pointer">&nbsp;</div></div><div class="videoConference-chatting-file-attachment-content-info-container Left">Drag and Drop your file to send</div></div></div></div></div></div><div class="videoConference-content-mainchat-tabcontent-attendeeschat-container Left"><div class="videoConference-content-Title-container Left videoConference-blue-font-color Font-Size-18">Attendees</div><div class="videoConference-content-SearchBox-container Left"><div class="videoConference-content-SearchBox-TextBox-container Left"><input type="text" class="videoConference-content-SearchBox-TextBox"/></div><div class="videoConference-content-SearchBox-SearchIcon-container Left Cursor-Pointer videoConference-sprite videoConference-sprite-Search" title="Contact Us">&nbsp;</div></div><div class="videoConference-content-Attendees-container Left"><div class="videoConference-content-Attendees-List-container Left"><div class="attendees-list-container"></div></div></div></div></div></div></div>',webCamContainer:'<div id="tilewebcam-container" class="bza-middle-container" style="display:none"></div>',screenContainer:'<div id="tileVideos-container" class="bza-middle-container" style="display:none"></div>',sharedFilesContainer:'<div id="sent-files" class="bza-middle-container" style="min-width: 200px;display:none"><div class="files-empty">There are no shared files.</div></div>',switchMediaContainer:'<div class="videoConference-content-sharingScreen-container Left"><div class="videoConference-content-sharingScreen-Row-container Left"><div class="videoConference-content-sharingScreen-Icon-container Left videoConference-sprite videoConference-sprite-ZoomInOutArrow" onclick="BizAPP.UI.Collaboration.SwitchStreams();"></div><div class="videoConference-content-sharingScreen-Title-container Left">Sharing</div></div><div class="videoConference-content-sharingScreen-Img-container Left"><div id="screen-conatainer" onclick="BizAPP.UI.Collaboration.StopEventPropagation(event);"><div id="sharing-video-container"></div></div></div></div>',whiteboardContainer:'<div class="videoConference-Whiteboard-container" style="display: none;"><div ><div id="draw"><canvas width="700" height="500" id="drawing-canvus" style="background: white;"></canvas></div><div style="margin-top:5px;"><span class="whiteboard-select">Currently selected : <a id="ink" href="javascript:void(0)"><i id="imgMode" class="fa fa-pencil" title="Click to select Eraser"></i></a></span><div id="dialog-form" title="Save Whiteboard"><fieldset><label for="name">Name</label><input type="text" name="name" id="name" value="" class="text ui-widget-content ui-corner-all"></fieldset></div><span><a id="save-whiteboard" href="javascript:void(0)">Save</a></span><span><a id="clear" href="javascript:void(0)">Clear</a></span><span class="saved-whiteboards"></span></div></div></div>',Init:function(a,b,c){$.getCss(BizAPP.UI.GetBasePath("Resources/WebRTC/jquery.qtip.min.css"));$.cachedScript(BizAPP.UI.GetBasePath("Resources/WebRTC/WebRTC.js")).done(function(){if(b){BizAPP.UI.Collaboration.reconnect=true;if(a.participantList){BizAPP.UI.Collaboration.participantsToReconnect=a.participantList}}if(!a.channelId){var d=(function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}})();a.channelId=d()}BizAPP.UI.Collaboration.connection=new RTCMultiConnection(a.channelId);BizAPP.UI.Collaboration.connection.DetectRTC.load(function(){if(!a.partialSupportEnabled&&!(BizAPP.UI.Collaboration.connection.DetectRTC&&BizAPP.UI.Collaboration.connection.DetectRTC.isWebRTCSupported)){if(a.blockIfNotSupported){var q={chrome:true,msie:true,safari:true,opera:true,unknown:true};var s={header:"This browser is not supported",paragraph1:"You are currently using an unsupported browser.",paragraph2:"Please install one of the supported browsers below to proceed:",closeMessage:"",display:["chrome","firefox"]};isBrowserSupported(q,s)}else{a.partialSupportEnabled=true;BizAPP.UI.Collaboration.Init(a,b,c)}}else{if(b){BizAPP.UI.Collaboration.participants=[]}BizAPP.UI.Collaboration.selector=a.selector;if(isMobile.any()&&isMobile.any().length){a.screenNotDefaultForParticipant=true}if(!a.partialSupportEnabled&&isChrome()&&BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource=="screen"&&a.mode!="VideoOnly"&&!a.screenNotDefaultForParticipant){var k='Required browser support is not enabled, install Virtual Room Addon before you can use this feature. \n<a id="chromeExt" href="https://chrome.google.com/webstore/detail/screen-capturing/mkbmmkmmkppgkahchamcaaommnjpkghd" target="_blank">Install chrome extension</a>';if(!b){a.screenNotDefaultForParticipant=true;k+='\n\n Click "Continue" to join without sharing screen.[type]info'}debug(k,"exception","",!b,"Continue","BizAPP.UI.Collaboration.Join("+JSON.stringify(a)+");")}else{var v="";var r="";if(a.extensionLinks){$.each(JSON.parse(a.extensionLinks),function(C,D){if(D.isLeft){v+='<div onclick="{1}">{0}</div>'.format(D.linkText,D.linkOnClick)}else{r+='<div onclick="{1}">{0}</div>'.format(D.linkText,D.linkOnClick)}})}var e;if(a.layoutSelector){e=$(a.layoutSelector)}else{e=$(BizAPP.UI.Collaboration.template.format(a.user.userid,a.user.name,v,r))}var i=BizAPP.UI.Control._getCommentNodes(e);var o=i.filter(function(){return this.nodeValue=="MainVideoContainer"});if(o.length){e.find(o[0]).replaceWith($(BizAPP.UI.Collaboration.mainVideoContainer))}var A=i.filter(function(){return this.nodeValue=="AttendeeContainer"});if(A.length){e.find(A[0]).replaceWith($(BizAPP.UI.Collaboration.attendeesContainer))}var g=i.filter(function(){return this.nodeValue=="ChatContainer"});if(g.length){e.find(g[0]).replaceWith($(BizAPP.UI.Collaboration.chatContainer))}var x=i.filter(function(){return this.nodeValue=="WebCamContainer"});if(x.length){e.find(x[0]).replaceWith($(BizAPP.UI.Collaboration.webCamContainer))}var u=i.filter(function(){return this.nodeValue=="ScreenContainer"});if(u.length){e.find(u[0]).replaceWith($(BizAPP.UI.Collaboration.screenContainer))}var l=i.filter(function(){return this.nodeValue=="SharedFileContainer"});if(l.length){e.find(l[0]).replaceWith($(BizAPP.UI.Collaboration.sharedFilesContainer))}var j=i.filter(function(){return this.nodeValue=="SwitchMediaContainer"});if(j.length){e.find(j[0]).replaceWith($(BizAPP.UI.Collaboration.switchMediaContainer))}var t=i.filter(function(){return this.nodeValue=="WhiteboardContainer"});if(t.length){e.find(t[0]).replaceWith($(BizAPP.UI.Collaboration.whiteboardContainer))}if(a.selector){$(a.selector).prepend(e)}else{$("body").prepend(e)}if(a.layoutSelector){$(a.layoutSelector).show()}if(b){$(".experiment").not(".data-box").closest("td").hide()}BizAPP.UI.LoadWhiteboard(function(){BizAPP.UI.Collaboration.GetParticipantList(function(C){C=C||"";BizAPP.UI.Whiteboard.Init(C);if(a.partialSupportEnabled){$(".videoConference-mainVideo-container, .videoConference-customView-container").hide();$(".videoConference-Whiteboard-container").show();realAjaxAsyncCall("HelperEx",getNextRequestId(),["GetUserFullnames",C],false,function(E,G,D){BizAPP.UI.Collaboration.participants=[];var F=JSON.parse(E.value[1]);$.each(F,function(J,I){var H={name:I,userid:J,initiator:false,hasMicrophone:false,hasWebcam:false,isScreenCapturingSupported:false,audioShared:false,videoShared:false,screenShared:false};BizAPP.UI.Collaboration.participants.push(H)});BizAPP.UI.Collaboration.UpdateParticipants(false)})}})});if(!a.partialSupportEnabled){var B=document.getElementById("rooms-list");var f={};var p=document.getElementById("main-video-container")||document.body;var y=document.getElementById("tilewebcam-container")||document.body;var h=document.getElementById("sharing-video-container");var z=document.getElementById("tileVideos-container")||document.body;var n=document.getElementById("chat-output"),w=document.getElementById("sent-files");var m=document.getElementById("chat-input");BizAPP.UI.Collaboration.connection.session={audio:true,video:true};BizAPP.UI.Collaboration.connection.onNewSession=function(C){if(sessions[C.sessionid]){return}sessions[C.sessionid]=C;if(!b&&a.sessionId==C.sessionid&&typeof(c)!="undefined"){BizAPP.UI.Collaboration.Connect(C.sessionid)}};BizAPP.UI.Collaboration.connection.onstream=function(G){var I=false;var H=["mute-audio","mute-video","full-screen","volume-slider"];if(BizAPP.UI.Collaboration.connection.session.audio&&!BizAPP.UI.Collaboration.connection.session.video){H=["mute-audio","full-screen"]}var C;if(G.stream.isScreen){if(h){C=(h.clientWidth)-50}else{C=(p.clientWidth)-50}}var F=getMediaElement(G.mediaElement,{width:C,title:G.userid,buttons:H,onMuted:function(L){BizAPP.UI.Collaboration.connection.streams[G.streamid].mute({audio:L=="audio",video:L=="video"})},onUnMuted:function(L){BizAPP.UI.Collaboration.connection.streams[G.streamid].unmute({audio:L=="audio",video:L=="video"})},onRecordingStarted:function(L){BizAPP.UI.Collaboration.connection.streams[G.streamid].startRecording({audio:L=="audio",video:L=="video"})},onRecordingStopped:function(L){BizAPP.UI.Collaboration.connection.streams[G.streamid].stopRecording(function(M){if(M.audio){BizAPP.UI.Collaboration.connection.saveToDisk(M.audio)}else{if(M.video){BizAPP.UI.Collaboration.connection.saveToDisk(M.video)}else{BizAPP.UI.Collaboration.connection.saveToDisk(M)}}},L)},onStopped:function(){BizAPP.UI.Collaboration.connection.peers[G.userid].drop()}});if(G.stream.isScreen){z.insertBefore(F,z.firstChild);$(F).wrap('<div class="stream-owner" style="width: 90%;display: block;margin: 5px auto;text-align: center;border: 1px solid #2D99D8;background-color: black;color: white;">');$(F).parent().prepend("<div>"+G.extra["session-name"]+"</div>");if(G.extra["session-name"]==BizAPP.UI.Collaboration.connection.extra["session-name"]){setTimeout(function(){F.media.play()},10)}else{setTimeout(function(){F.media.play()},1000)}$(F.media).addClass("screen");if(G.isInitiator){var K=$(F).clone(true)[0];var D;if(b&&a.mode!="ScreenOnly"){if(h){h.insertBefore(K,h.firstChild);$(h).find("video").get(0).play();D=$(h).find("video")}}else{p.insertBefore(K,p.firstChild);$(p).find("video").get(0).play();D=$(p).find("video");I=true}if(D){D.get(0).play();D.css("max-height","")}}}else{y.insertBefore(F,y.firstChild);$(F).wrap('<div class="stream-owner" style="width: 90%;display: block;margin: 5px auto;text-align: center;border: 1px solid #2D99D8;background-color: black;color: white;">');$(F).parent().prepend("<div>"+G.extra["session-name"]+"</div>");if(G.extra["session-name"]==BizAPP.UI.Collaboration.connection.extra["session-name"]){setTimeout(function(){F.media.play()},10)}else{setTimeout(function(){F.media.play()},1000)}$(F.media).addClass("webcam");if(G.isInitiator){var E=$(F).clone(true)[0];var J;if(b||a.mode=="VideoOnly"){p.insertBefore(E,p.firstChild);J=$(p).find("video");I=true}else{if(h){h.insertBefore(E,h.firstChild);J=$(h).find("video")}}if(J){J.get(0).play();if(G.type=="local"||G.isInitiator){J.get(0).muted=true;J.get(0).volume=0}J.css("max-height","")}}}$(F).css("width","auto");$(F).find("video").css("max-height","");$("#webcam-container").css("height","auto");$(".media-container").attr("onclick","BizAPP.UI.Collaboration.CenterStream(event);");$(F).find(".volume-control, .media-controls").attr("onclick","BizAPP.UI.Collaboration.StopEvent(event);");if(G.type=="local"){F.media.muted=true;F.media.volume=0}if(G.isInitiator){$(".videoConference-videoDispaly-holder-container").next("div.videoConference-videoDispaly-Controls-container").show()}setTimeout(function(){BizAPP.UI.Collaboration.UpdateParticipants(b);BizAPP.UI.Collaboration.InitAccordion();BizAPP.UI.Collaboration.UpdateCurrentTime();BizAPP.UI.Collaboration.UpdateStreamCount();BizAPP.UI.Collaboration.WhiteboardInit(I)},1000)};BizAPP.UI.Collaboration.connection.onstreamended=function(C){if(C.mediaElement){if($(C.mediaElement).closest(".stream-owner").length){$(C.mediaElement).closest(".stream-owner").remove()}else{$(C.mediaElement).closest(".media-container").remove()}}BizAPP.UI.Collaboration.UpdateStreamCount()};BizAPP.UI.Collaboration.connection.onmessage=function(C){if(!b&&C.data.startsWith("[{")){BizAPP.UI.Collaboration.participants=JSON.parse(C.data);BizAPP.UI.Collaboration.UpdateParticipants(b)}else{BizAPP.UI.Collaboration.PostMessage(C.extra["session-name"],C.data,true,C.extra.userid);$('[onclick="BizAPP.UI.Collaboration.ShowChat()"]').addClass("blink");console.debug(C.userid,"posted",C.data);console.log("latency:",C.latency,"ms")}};BizAPP.UI.Collaboration.connection.onclose=function(C){BizAPP.UI.Collaboration.participants=$.grep(BizAPP.UI.Collaboration.participants,function(D){return D.name!=C.extra["session-name"]});if(C.extra.initiator){BizAPP.UI.InlinePopup.Alert({title:"",header:"Error",errorMessage:"Connection lost.. \nPlease wait while the connection is being re-established.",btnOk:true,txtOk:"OK",type:"error",addnInfo:"",hideAddnBtns:true})}else{BizAPP.UI.Collaboration.UpdateParticipants(b);BizAPP.UI.Collaboration.PostMessage(C.extra["session-name"],C.extra["session-name"]+" has left the session.",true,C.extra.userid,true);$('[onclick="BizAPP.UI.Collaboration.ShowChat()"]').addClass("blink")}};BizAPP.UI.Collaboration.connection.onopen=function(E){if(b){var C={name:E.extra["session-name"],userid:E.extra.userid,initiator:E.extra.initiator,hasMicrophone:E.extra.hasMicrophone,hasWebcam:E.extra.hasWebcam,isScreenCapturingSupported:E.extra.isScreenCapturingSupported,audioShared:E.extra.audioShared,videoShared:E.extra.videoShared,screenShared:E.extra.screenShared};BizAPP.UI.Collaboration.participants.push(C);BizAPP.UI.Collaboration.connection.send(JSON.stringify(BizAPP.UI.Collaboration.participants));BizAPP.UI.Collaboration.UpdateParticipants(b)}var D=$(".videoConference").attr("bza_wc_direction");if(b||!(D=="one-way"||D=="one-to-one")){if(document.getElementById("chat-input")){document.getElementById("chat-input").disabled=false}if(document.getElementById("file")){document.getElementById("file").disabled=false}if(document.getElementById("open-new-session")){document.getElementById("open-new-session").disabled=true}}};BizAPP.UI.Collaboration.connection.autoSaveToDisk=false;BizAPP.UI.Collaboration.connection.onFileProgress=function(C){var D=C.currentPosition||C.maxChunks||helper.progress.max;$.danidemo.updateFileProgress(0,D)};BizAPP.UI.Collaboration.connection.onFileStart=function(C){var D=document.createElement("div");D.title=C.name;BizAPP.UI.Collaboration.AppendDIV(D,w);f[C.uuid]={div:D,progress:D.querySelector("progress"),label:D.querySelector("label")};$.danidemo.addFile("#demo-files",0,C)};BizAPP.UI.Collaboration.connection.onFileEnd=function(C){$("#sent-files .files-empty").remove();f[C.uuid].div.innerHTML='<i class="fa fa-download"></i>&nbsp;<a href="'+C.url+'" target="_blank" style="text-decoration:underline;color: #000080" download="'+C.name+'">'+C.name+"</a>";$(f[C.uuid].div).addClass("VideoConference-FileSharing-File").css("padding","5px");var D=$(f[C.uuid].div)[0].outerHTML;BizAPP.UI.Collaboration.PostMessage(C.extra["session-name"],D,true,C.extra.userid);if(BizAPP.UI.Collaboration.connection.extra.userid!=C.extra.userid){$('[onclick="BizAPP.UI.Collaboration.ShowChat()"]').addClass("blink")}$(".videoConference-AlertCnt").text($("#sent-files .VideoConference-FileSharing-File").length.toString()).show()};BizAPP.UI.Collaboration.connection.openSignalingChannel=function(C){var D=C.channel||this.channel;onMessageCallbacks[D]=C.onmessage;if(C.onopen){setTimeout(C.onopen,1000)}return{send:function(E){if($(".videoConference").attr("bza_wc_direction")=="one-to-one"){E.oneToOne=true;BizAPP.UI.Collaboration.SendSignalRMessage(E,D)}else{BizAPP.UI.Collaboration.GetParticipantList(function(F){F=F||"";E.userList=F;BizAPP.UI.Collaboration.SendSignalRMessage(E,D)})}}}};BizAPP.UI.Collaboration.connection.onPresenterChange=function(C){};m.onkeypress=function(C){if(C.keyCode!==13||!this.value){return}BizAPP.UI.Collaboration.SendMessage()};BizAPP.UI.Collaboration.connection.connect();BizAPP.UI.Collaboration.DisplayModeWise(a);BizAPP.UI.Collaboration.InitAccordion();BizAPP.UI.Collaboration.InitUploadControl();BizAPP.UI.WordEditor.renewSessionForControl("Container:webconference");if(typeof(c)!="undefined"){c()}}}}})})},Setup:function(a){BizAPP.UI.Collaboration.DetectPlugin(function(){BizAPP.UI.Collaboration.Init(a,true,function(){var b=$(".videoConference").attr("bza_wc_direction");var h;switch(b){case"one-way":h="one-way";break;case"one-to-one":h="many-to-many";break;default:h="many-to-many"}var f=BizAPP.UI.Collaboration.GetConfiguredMode(a);var e=f.split("+");var g={};for(var d=0;d<e.length;d++){if(e[d]){g[e[d]]=true}}var c=256;if(h=="one-to-one"){c=1}if(h=="one-to-many"){g.broadcast=true}if(h=="one-way"){g.oneway=true}BizAPP.UI.Collaboration.connection.DetectRTC.load(function(){BizAPP.UI.Collaboration.connection.extra={"session-name":a.user.name||"Anonymous",userid:a.user.userid,initiator:true,hasMicrophone:BizAPP.UI.Collaboration.connection.DetectRTC.hasMicrophone,hasWebcam:BizAPP.UI.Collaboration.connection.DetectRTC.hasWebcam,isScreenCapturingSupported:BizAPP.UI.Collaboration.connection.DetectRTC.isScreenCapturingSupported,audioShared:g.audio,videoShared:g.video,screenShared:g.screen};BizAPP.UI.Collaboration.connection.session=g;BizAPP.UI.Collaboration.connection.maxParticipantsAllowed=c;BizAPP.UI.Collaboration.connection.sessionid=a.sessionID||"Anonymous";sessions[a.sessionID]=g;BizAPP.UI.Collaboration.channel=BizAPP.UI.Collaboration.connection.channel;var i={name:a.user.name||"Anonymous",userid:a.user.userid,initiator:true,hasMicrophone:BizAPP.UI.Collaboration.connection.extra.hasMicrophone,hasWebcam:BizAPP.UI.Collaboration.connection.extra.hasWebcam,isScreenCapturingSupported:BizAPP.UI.Collaboration.connection.extra.isScreenCapturingSupported,audioShared:BizAPP.UI.Collaboration.connection.extra.audioShared,videoShared:BizAPP.UI.Collaboration.connection.extra.videoShared,screenShared:BizAPP.UI.Collaboration.connection.extra.screenShared};BizAPP.UI.Collaboration.participants.push(i);BizAPP.UI.Collaboration.UpdateParticipants(true);BizAPP.UI.Collaboration.connection.open();if(typeof(a.callback)!="undefined"){a.callback(BizAPP.UI.Collaboration.channel,BizAPP.UI.Collaboration.connection.sessionid,a.selector)}})})})},Join:function(a){BizAPP.UI.Collaboration.DetectPlugin(function(){BizAPP.UI.Collaboration.Init(a,false,function(){if(sessions[a.sessionID]){session=sessions[a.sessionID];BizAPP.UI.Collaboration.Connect(a,session,a.screenNotDefaultForParticipant)}else{var b=$.connection.webRtcHub;b.server.getSessionDetails($.connection.hub.qs.sessionid,a.sessionID).done(function(c){if(c){session=JSON.parse(c);sessions[a.sessionID]=session;BizAPP.UI.Collaboration.Connect(a,session,a.screenNotDefaultForParticipant)}else{debug("Failed to connect to the conference room, could not find the details.","exception")}})}})})},SendSignalRMessage:function(c,b){c=JSON.stringify({message:c,channel:b});var a=$.connection.webRtcHub;a.server.sendWebRTCMsg(c)},MakePresenter:function(c){var b=$(c.target).closest(".user-list-item").attr("userid");var a={makePresenter:true,uniqueId:b,extra:BizAPP.UI.Collaboration.connection.extra||{},userid:BizAPP.UI.Collaboration.connection.userid,sessionid:BizAPP.UI.Collaboration.connection.sessionid};BizAPP.UI.Collaboration.connection.socket.send2(a)},PresentAgain:function(c){var b=$(c.target).closest(".user-list-item").attr("userid");var a={presentAgain:true,uniqueId:b,extra:BizAPP.UI.Collaboration.connection.extra||{},userid:BizAPP.UI.Collaboration.connection.userid,sessionid:BizAPP.UI.Collaboration.connection.sessionid};BizAPP.UI.Collaboration.connection.socket.send2(a);$(BizAPP.UI.Collaboration.connection.streams.selectAll([])).each(function(){if(this.extra.userid==b){$(this.mediaElement).closest(".media-container").show()}else{$(this.mediaElement).closest(".media-container").hide()}})},Connect:function(a,c,b){if(!c){alert("No room to join.")}BizAPP.UI.Collaboration.connection.DetectRTC.load(function(){if((isChrome()&&BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource=="screen")||b){c.session.screen=false}if(!BizAPP.UI.Collaboration.connection.DetectRTC.hasMicrophone){c.session.audio=false}if(!BizAPP.UI.Collaboration.connection.DetectRTC.hasWebcam){c.session.video=false}BizAPP.UI.Collaboration.connection.extra={"session-name":a.user.name||"Anonymous",userid:a.user.userid,initiator:false,hasMicrophone:BizAPP.UI.Collaboration.connection.DetectRTC.hasMicrophone,hasWebcam:BizAPP.UI.Collaboration.connection.DetectRTC.hasWebcam,isScreenCapturingSupported:BizAPP.UI.Collaboration.connection.DetectRTC.isScreenCapturingSupported,audioShared:c.session.audio,videoShared:c.session.video,screenShared:c.session.screen};BizAPP.UI.Collaboration.connection.join(c);$("#webcam-container").css("height","auto")})},GetConfiguredMode:function(a){var b="";switch(a.mode){case"ScreenOnly":b="screen+";break;case"VideoOnly":b="video+audio+";break;default:b="screen+video+audio+"}if(a.dataEnabled){b=b+"data"}return b},DisplayModeWise:function(a){switch(a.mode){case"ScreenOnly":$('[onclick="BizAPP.UI.Collaboration.ShowVideos();"]').hide();$(".videoConference-content-sharingScreen-Row-container").hide();$(".videoConference-content-sharingScreen-container").css("min-height","83px");break;case"VideoOnly":$('[onclick="BizAPP.UI.Collaboration.ShowScreens();"]').hide();$(".videoConference-content-sharingScreen-Row-container").hide();$(".videoConference-content-sharingScreen-container").css("min-height","156px");break;default:}if(!a.dataEnabled){$(".videoConference-sprite-Chat").parent().hide()}},ShareScreen:function(a){BizAPP.UI.Collaboration.connection.addStream({screen:true,oneway:true})},ShareVideo:function(a){BizAPP.UI.Collaboration.connection.addStream({video:true})},ShowScreens:function(a){$(".bza-middle-container").hide();$("#tileVideos-container").show()},ShowVideos:function(a){$(".bza-middle-container").hide();$("#tilewebcam-container").show()},ShowWhiteboard:function(a){if($(".videoConference-Whiteboard-container").is(":visible")){$(".videoConference-Whiteboard-container, .videoConference-customView-container").hide();$(".videoConference-mainVideo-container").show()}else{$(".videoConference-mainVideo-container, .videoConference-customView-container").hide();$(".videoConference-Whiteboard-container").show()}},WhiteboardInit:function(a){if(a){BizAPP.UI.Collaboration.ShowWhiteboard();setTimeout(BizAPP.UI.Collaboration.ShowWhiteboard(),100)}},ShowConference:function(a){$(".bza-middle-container").hide();$("#course-container").show()},ShowAttendees:function(a){$(".bza-middle-container").hide();$("#attendees-container").show()},ShowChat:function(a){$('[onclick="BizAPP.UI.Collaboration.ShowChat()"]').removeClass("blink");$(".bza-middle-container").hide();$("#chat-container").show()},ShowSharedFiles:function(a){$(".bza-middle-container").hide();$("#sent-files").show()},MenuLinkDrilldown:function(a){a=a||{formId:"",controlname:"",context:"",linkCtrlName:"",targetViewControlName:""};ajaxAsyncCall("HelperEx",["WebConferenceLinkDrilldown",a.formId,a.controlname,a.context,a.linkCtrlName,a.targetViewControlName]);$(".bza-middle-container").hide();$("#extension-view-container").parent().show()},UpdateCurrentTime:function(){$("#main-video-container").find("video").on("timeupdate",function(a){$(".videoConference-videoDispaly-Controls-VideoTime-container").text("00:"+BizAPP.UI.Collaboration.TimeFormat(this.currentTime))})},TimeFormat:function(c){var a=Math.floor(c/60)<10?"0"+Math.floor(c/60):Math.floor(c/60);var b=Math.floor(c-(a*60))<10?"0"+Math.floor(c-(a*60)):Math.floor(c-(a*60));return a+":"+b},UpdateStreamCount:function(){$('[onclick="BizAPP.UI.Collaboration.ShowScreens();"] .videoConference-menu-Link-title-count').text($("#tileVideos-container").find("video").length.toString());$('[onclick="BizAPP.UI.Collaboration.ShowVideos();"] .videoConference-menu-Link-title-count').text($("#tilewebcam-container").find("video").length.toString())},SwitchStreams:function(){var a=$("#sharing-video-container").find("video").attr("class");$("#main-video-container").append($("#sharing-video-container").find(".media-container"));$("#sharing-video-container").append($("#main-video-container").find("video").not("."+a).closest(".media-container"));$("#main-video-container").find("video").get(0).play();setTimeout(function(){$("#sharing-video-container").find("video").get(0).play()},10);BizAPP.UI.Collaboration.InitAccordion()},CenterStream:function(a){if($(a.target).closest("#main-video-container").length){return}$("#main-video-container").find(".media-container").remove();$("#main-video-container").append($(a.target).closest(".media-container").clone(true)[0]);setTimeout(function(){var b=$("#main-video-container").find("video");b.get(0).play();b.get(0).muted=true;b.get(0).volume=0},10);$(".videoConference-customView-container, .videoConference-Whiteboard-container").hide();$(".videoConference-mainVideo-container").show();BizAPP.UI.Collaboration.InitAccordion();BizAPP.UI.Collaboration.UpdateCurrentTime()},PausePlayVideo:function(b){var a=$(b.target);if(a.attr("title")=="Play"){a.removeClass("videoConference-sprite-VideoPlay");a.addClass("videoConference-sprite-VideoPause");$("#main-video-container video").get(0).play();a.attr("title","Pause")}else{a.removeClass("videoConference-sprite-VideoPause");a.addClass("videoConference-sprite-VideoPlay");$("#main-video-container video").get(0).pause();a.attr("title","Play")}},ZoomOutVideo:function(b){var a=$("#main-video-container video");if(a.attr("class")=="webcam"){$(".videoConference-sprite-Sharing").click();$("#tilewebcam-container").find("#"+a.attr("id")).closest(".media-container").find(".volume-control .zoom-in").click()}else{$(".videoConference-sprite-Screen").click();$("#tileVideos-container").find("#"+a.attr("id")).closest(".media-container").find(".volume-control .zoom-in").click()}},EqualHeight:function(b){var a=0,c=0,f=new Array(),e,d=0;$(b).each(function(){e=$(this);$(e).height("auto");topPostion=e.position().top;if(c!=topPostion){for(currentDiv=0;currentDiv<f.length;currentDiv++){f[currentDiv].height(a)}f.length=0;c=topPostion;a=e.height();f.push(e)}else{f.push(e);a=(a<e.height())?(e.height()):(a)}for(currentDiv=0;currentDiv<f.length;currentDiv++){f[currentDiv].height(a)}})},ClosestEdge:function(g,f,i,c){var d=BizAPP.UI.Collaboration.DistMetric(g,f,i/2,0);var e=BizAPP.UI.Collaboration.DistMetric(g,f,i/2,c);var j=BizAPP.UI.Collaboration.DistMetric(g,f,0,c/2);var a=BizAPP.UI.Collaboration.DistMetric(g,f,i,c/2);var b=Math.min(d,e,j,a);switch(b){case j:return"left";case a:return"right";case d:return"top";case e:return"bottom"}},DistMetric:function(a,f,b,c){var e=a-b;var d=f-c;return(e*e)+(d*d)},TabletViewInit:function(){$(window).resize(function(){if($(window).width()<=800){$(".videoConference .videoConference-menu-Link-container").click(function(){var b=$(this).parent();var a=b.next(".videoConference-content-container");if(a.is(":visible")){a.hide("slide",{direction:"right"},500)}else{a.show("slide",{direction:"right"},500)}});$(".videoConference-content-NavLinks-Link-img-container.videoConference-sprite-Close").click(function(){var a=$(this).closest(".videoConference .videoConference-content-container");if(a.is(":visible")){a.hide("slide",{direction:"right"},500)}})}else{$(".videoConference .videoConference-content-container").show()}});if($(window).width()<=800){$(".videoConference .videoConference-menu-Link-container").click(function(){var b=$(this).parent();var a=b.next(".videoConference-content-container");if(a.is(":visible")){a.hide("slide",{direction:"right"},500)}else{a.show("slide",{direction:"right"},500)}});$(".videoConference-content-NavLinks-Link-img-container.videoConference-sprite-Close").click(function(){var a=$(this).closest(".videoConference .videoConference-content-container");if(a.is(":visible")){a.hide("slide",{direction:"right"},500)}})}},InitChatAccordion:function(a,c,d){var b=$(c);b.parents(a).find(c).removeClass(d);b.next("div").hide();b.click(function(){var e=$(this);b.removeClass(d);b.next("div").hide("slide",{direction:"up"},200);if(!e.hasClass(d)&&!e.next("div").is(":visible")){e.addClass(d);e.next("div").show("slide",{direction:"up"},800)}else{e.removeClass(accordionHeader);e.next("div").hide("slide",{direction:"up"},500)}})},UpdateParticipants:function(b){$(".attendees-list-container").find("div.user-list-item").remove();var a=[];var c=$(".videoConference").attr("bza_wc_direction");if(!b&&(c=="one-way"||c=="one-to-one")){$.each(BizAPP.UI.Collaboration.participants,function(){var d=$(this)[0];if(d.initiator||d.userid==BizAPP.UI.Collaboration.connection.extra.userid){a.push(d)}})}else{a=BizAPP.UI.Collaboration.participants}$.each(a,function(){var d=$(this)[0];$(".attendees-list-container").append('<div class="videoConference-content-Attendees-List-Row-container Left user-list-item" userid="{0}"><div class="videoConference-content-Attendees-List-Row-AttendeesImg-container Left">			<img class="videoConference-content-Attendees-List-Row-AttendeesImg" src="testresource.aspx?resize=1&amp;h=50&amp;w=50&amp;id2=ESystema4d6a&amp;userid={0}"/></div>			<div class="videoConference-content-Attendees-List-Row-AttendeesName-container Left single-line-ellipsis ">{1}</div>			{2}{3}{4}{5}{6}</div>'.format(d.userid,d.name,'<div class="videoConference-content-Attendees-List-Row-AttendeesVoice-container Left videoConference-sprite            videoConference-sprite-Voice {0}" title="{1}">&nbsp;</div>'.format(d.audioShared?"videoConference-sprite-Voice-Active":"",d.userid==BizAPP.UI.Collaboration.connection.extra.userid?(!d.audioShared?"Share Audio":"Audio has been shared"):(!d.audioShared?"Audio has not been shared":"Audio has been shared")),'<div class="videoConference-content-Attendees-List-Row-AttendeesVideo-container             Left videoConference-sprite videoConference-sprite-Video {0}" title="{2}" onclick="{1}">&nbsp;</div>'.format(d.videoShared?"videoConference-sprite-Video-Active":"",(d.userid==BizAPP.UI.Collaboration.connection.extra.userid&&!d.videoShared)?"BizAPP.UI.Collaboration.ShareVideo(event);":"",d.userid==BizAPP.UI.Collaboration.connection.extra.userid?(!d.videoShared?"Share Video":"Webcam has been shared"):(!d.videoShared?"Webcam has not been shared":"Webcam has been shared")),'<div class="videoConference-content-Attendees-List-Row-AttendeesVideo-container Left fa fa-desktop videoConference-Screen {0}" title="{2}" onclick="{1}"></div>'.format(d.screenShared?"videoConference-Screen-Active":"Webcam has been shared",(d.userid==BizAPP.UI.Collaboration.connection.extra.userid&&!d.screenShared)?"BizAPP.UI.Collaboration.ShareScreen(event);":"",d.userid==BizAPP.UI.Collaboration.connection.extra.userid?(!d.screenShared?"Share Screen":"Screen has been shared"):(!d.screenShared?"Screen has not been shared":"Screen has been shared")),'<div class="videoConference-content-Attendees-List-Row-AttendeesVideo-container Left videoConference-sprite videoConference-sprite-chatAttendees {0}" title="{2}" onclick="{1}">&nbsp;</div>'.format(d.initiator?"videoConference-sprite-chatAttendees-Active":"",(BizAPP.UI.Collaboration.connection.extra.initiator&&!d.initiator)?"BizAPP.UI.Collaboration.MakePresenter1(event);":"",BizAPP.UI.Collaboration.connection.extra.initiator?(!d.initiator?"Make Presenter":""):(!d.initiator?"Attendee":"Presenter")),d.userid==BizAPP.UI.Collaboration.connection.extra.userid?"":'<div class="videoConference-content-Attendees-List-Row-AttendeesVideo-container Left fa fa-comment-o videoConference-Screen videoConference-Screen-Active" title="Initiate Chat" onclick="BizAPP.UI.Collaboration.InitiateChat(\'{0}\');"></div>'.format(d.userid)));$('[onclick="BizAPP.UI.Collaboration.ShowAttendees();"] .videoConference-menu-Link-title-count, .videoConference-mainchat-tab-ChatCount').text(a.length.toString())});BizAPP.UI.Collaboration.StoreParticipantList()},InitiateChat:function(a){BizAPP.Session.EvaluateExpression({expression:'Session.InitiateChat("'+a+'")',compute:true,callback:function(){$(".popout").click()}})},InitAccordion:function(){BizAPP.UI.Collaboration.EqualHeight(".videoConference-landingCol-same-height");$(document).resize(function(){BizAPP.UI.Collaboration.EqualHeight(".videoConference-landingCol-same-height")});$(".videoConference-videoDispaly-holder-container").mouseover(function(c){c.stopPropagation();var b=BizAPP.UI.Collaboration.ClosestEdge(c.pageX,c.pageY,$(this).width(),$(this).height());if(b=="bottom"){$(this).next("div.videoConference-videoDispaly-Controls-container").show("slide",{direction:"bottom"},500)}});BizAPP.UI.Collaboration.TabletViewInit();var a=".accordian-h1";BizAPP.UI.Collaboration.InitChatAccordion(".tabcontent-accordion-Wrapper",a,".tabcontent-accordion-Active");$(".videoConference-content-mainchat-tab-livechat-container").click(function(){if(!$(".videoConference-content-mainchat-tabcontent-livechat-container").is(":visible")){$(".videoConference-content-mainchat-tabcontent-attendeeschat-container").hide("slide",{direction:"right"},500);$(".videoConference-content-mainchat-tabcontent-livechat-container").show("slide",{direction:"left"},800,function(){BizAPP.UI.Collaboration.EqualHeight(".videoConference-landingCol-same-height")})}});$(".videoConference-content-mainchat-tab-attendeeschat-container").click(function(){if(!$(".videoConference-content-mainchat-tabcontent-attendeeschat-container").is(":visible")){$(".videoConference-content-mainchat-tabcontent-livechat-container").hide("slide",{direction:"left"},500);$(".videoConference-content-mainchat-tabcontent-attendeeschat-container").show("slide",{direction:"right"},800,function(){BizAPP.UI.Collaboration.EqualHeight(".videoConference-landingCol-same-height")})}});if(typeof(callback)!="undefined"){callback()}},InitUploadControl:function(){$.getCss(BizAPP.UI.GetBasePath("resources/uploader/uploader.css?v="+__bts_));BizAPP.UI.TextEditor.LoadFontAwesomeCss();$.cachedScript(BizAPP.UI.GetBasePath("resources/uploader/dmuploader.js?v="+__bts_)).done(function(a,c){$("#drag-and-drop-zoneWebRTC").bind("dragenter",BizAPP.UI.TextEditor.EnableImageUploader).bind("dragover",BizAPP.UI.TextEditor.EnableImageUploader).bind("drop",BizAPP.UI.TextEditor.EnableImageUploader);var b=$("#drag-and-drop-zoneWebRTC").dmUploader({url:"",onInit:function(){console.log("Uploader init successfull")},onBeforeUpload:function(d){ProcessingStatus(true,true)},onNewFile:function(e,d){if(BizAPP.UI.Collaboration.participants.length>1){BizAPP.UI.Collaboration.connection.send(d)}else{debug("Files can be sent only when there are two or more participants.[type]info","exception")}},onUploadSuccess:function(e,d){ProcessingStatus(false,true)}})})},StoreValue:function(b,d,a){var e=$(a);var c={};c.ChannelId=b;c.SessionId=d;BizAPP.RuntimeObject.SetFieldValue({roid:getObject(e),fieldName:e.attr("fieldname"),fieldValue:JSON.stringify(c),refreshView:false})},StoreParticipantList:function(){var b=$(BizAPP.UI.Collaboration.selector);var a="";$.each(BizAPP.UI.Collaboration.participants,function(d,c){if(!c.initiator){a+=((d==0?"":",")+c.userid)}});a=a.replace(/(^,)|(,$)/g,"");if(a){BizAPP.RuntimeObject.SetFieldValue({roid:getObject(b),fieldName:b.attr("participantsfieldname"),fieldValue:a,refreshView:false})}},GetParticipantList:function(b){if(BizAPP.UI.Collaboration.allAttendees){b(BizAPP.UI.Collaboration.allAttendees)}else{var a=$(BizAPP.UI.Collaboration.selector);BizAPP.RuntimeObject.GetFieldValue({roid:getObject(a),fieldName:"Attendees.Attendee.uniqueid",callback:function(c){BizAPP.RuntimeObject.GetFieldValue({roid:getObject(a),fieldName:"Host.uniqueid",callback:function(e){c.push(e);var f=c.filter(function(j,h,g){return h==g.indexOf(j)});var d=$.grep(f,function(g){return g!==BizAPP.UI.Collaboration.connection.extra.userid});BizAPP.UI.Collaboration.allAttendees=d.join(",");b(BizAPP.UI.Collaboration.allAttendees)}})}})}},EnableImageUploader:function(a){a.originalEvent.stopPropagation();a.originalEvent.preventDefault()},UpdateLabel:function(c,b){if(c.position==-1){return}var a=+c.position.toFixed(2).split(".")[1]||100;$.danidemo.updateFileProgress(0,a)},GetCurrentTime:function(){var c=" am";var b=new Date();var d=(b.getMinutes()<10?"0":"")+b.getMinutes();var a=b.getHours();a=(a+24)%24;if(a==0){a=12}else{if(a>=12){if(a!=12){a=a%12}c=" pm"}}return a+":"+d+c},SendMessage:function(){var a=$(".videoConference-chatting-content-EditBox-Textarea-container #chat-input");BizAPP.UI.Collaboration.PostMessage(BizAPP.UI.Collaboration.connection.extra["session-name"],a.val(),false,BizAPP.UI.Collaboration.connection.extra.userid);BizAPP.UI.Collaboration.connection.send(a.val());a.val("")},PostMessage:function(c,f,e,a,d){var b;if(d){b='<div class="videoConference-chatting-content-{3}Row-container Left Padding-Top-5 Padding-Bottom-5 videoConference-chat-message"><div class="videoConference-chatting-content-ChatUser-ChatDetails-container Left" style="font-style: italic;color: #999;">{0}</div><div class="videoConference-chatting-content-ChatUser-ChatTime-container Left">{4}</div></div>'}else{b='<div class="videoConference-chatting-content-{3}Row-container Left Padding-Top-5 Padding-Bottom-5 videoConference-chat-message"><div class="videoConference-chatting-content-ChatUser-Img-container {3} ">                        <img class="videoConference-chatting-content-ChatUser-Img" src="testresource.aspx?resize=1&amp;h=35&amp;w=35&amp;id2=ESystema4d6a&amp;userid={2}" style="margin-top: -2px;" />                        </div><div class="videoConference-chatting-content-ChatUser-ChatDetails-container Left"><span class="videoConference-chatting-content-ChatUser-Name">                        {1} : </span>{0}</div><div class="videoConference-chatting-content-ChatUser-ChatTime-container Left">{4}</div></div>'}var g;if(e){g=b.format(f,c,a,"Left",BizAPP.UI.Collaboration.GetCurrentTime())}else{g=b.format(f,c,a,"Right",BizAPP.UI.Collaboration.GetCurrentTime())}$("#chat-output").append(g);$("#chat-output").scrollTop($("#chat-output").find(".videoConference-chat-message:last").position().top)},AppendDIV:function(g,c,f,e){var b=document.getElementById("chat-output"),a=document.getElementById("sent-files");if(typeof g==="string"){var d=g;g=document.createElement("div");if(e){g.className+="msg chat_msg_left"}else{g.className+="msg chat_msg_right"}g.innerHTML=d}if(!c){b.insertBefore(g,b.firstChild)}else{$(a).append(g)}g.tabIndex=0;g.focus()},StopEventPropagation:function(a){if($(a.target).hasClass("mute-video")||$(a.target).hasClass("unmute-video")){a.stopPropagation()}},StopEvent:function(a){a.stopPropagation()},DetectPlugin:function(c){var b=!!navigator.webkitGetUserMedia;var a;BizAPP.UI.Collaboration.DetectRTC.screen={chromeMediaSource:"screen",getSourceId:function(d){if(!d){throw'"callback" parameter is mandatory.'}a=d;window.postMessage("get-sourceId","*")},isChromeExtensionAvailable:function(d){if(!d){return}if(BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource=="desktop"){return d(true)}window.postMessage("are-you-there","*");setTimeout(function(){if(BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource=="screen"){d(false)}else{d(true)}},2000)},onMessageCallback:function(d){if(!(typeof d=="string"||!!d.sourceId)){return}console.log("chrome message",d);if(d=="PermissionDeniedError"){BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource="PermissionDeniedError";if(a){return a("PermissionDeniedError")}else{throw new Error("PermissionDeniedError")}}if(d=="rtcmulticonnection-extension-loaded"){BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource="desktop"}if(d.sourceId){BizAPP.UI.Collaboration.DetectRTC.screen.sourceId=d.sourceId;if(a){a(BizAPP.UI.Collaboration.DetectRTC.screen.sourceId)}}},getChromeExtensionStatus:function(f){if(!!navigator.mozGetUserMedia){return f("not-chrome")}var d="mkbmmkmmkppgkahchamcaaommnjpkghd";var e=document.createElement("img");e.src="chrome-extension://"+d+"/icon.png";e.onload=function(){BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource="screen";window.postMessage("are-you-there","*");setTimeout(function(){if(!BizAPP.UI.Collaboration.DetectRTC.screen.notInstalled){f("installed-enabled")}},2000)};e.onerror=function(){BizAPP.UI.Collaboration.DetectRTC.screen.notInstalled=true;f("not-installed")}}};if(window.postMessage&&b){BizAPP.UI.Collaboration.DetectRTC.screen.isChromeExtensionAvailable()}BizAPP.UI.Collaboration.DetectRTC.screen.getChromeExtensionStatus(function(d){if(d=="installed-enabled"){BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource="desktop"}if(typeof(c)!="undefined"){c()}});window.addEventListener("message",function(d){if(d.origin!=window.location.origin){return}BizAPP.UI.Collaboration.DetectRTC.screen.onMessageCallback(d.data)});if(b){console.log("current chromeMediaSource",BizAPP.UI.Collaboration.DetectRTC.screen.chromeMediaSource)}else{if(typeof(c)!="undefined"){c()}}}};